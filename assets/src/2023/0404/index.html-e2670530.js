var R=Object.defineProperty;var y=(o,t,r)=>t in o?R(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r;var s=(o,t,r)=>(y(o,typeof t!="symbol"?t+"":t,r),r);import"../../../modulepreload-polyfill-3cfb730f.js";/* empty css                     */import{c as A}from"../../../index-8d178fc0.js";import{t as k}from"../../../tweakpane-9ece380b.js";import{l as x}from"../../../loop-9a51de3b.js";import{s as O}from"../../../utils-410b772c.js";import{c as V}from"../../../petal-feaf2d7c.js";import"../../../_commonjsHelpers-725317a4.js";function S(o){const t=[],r=o.captureStream(30),e=new MediaRecorder(r,{mimeType:"video/webm; codecs=vp8"});e.ondataavailable=c=>{console.log(c),t.push(c.data)},e.start(),e.onstop=()=>{a(t)};const a=c=>{console.log("onstop");const f=new Blob(c,{type:"video/webm"}),P=URL.createObjectURL(f),l=document.createElement("a");l.style.display="none",l.href=P,l.download="video.webm",document.body.appendChild(l),l.click(),console.log(l),setTimeout(()=>{document.body.removeChild(l),URL.revokeObjectURL(P)})};return e}let u=window.innerWidth,m=window.innerHeight,{ctx:d,canvas:I}=A(u,m);const n={numPetals:10,numLines:450,drawAtOnce:5,cpVarX:.1,cpVarY:.02,speed:5e-4,addRecordOption:!1};let X=new k.Pane,i=X.addFolder({title:"flower"});i.addInput(n,"numPetals",{min:1,max:40,step:2});i.addInput(n,"numLines",{min:10,max:1e3,step:1});i.addInput(n,"drawAtOnce",{min:1,max:10,step:1});i.addInput(n,"cpVarX",{label:"cp x var (thickness)",min:0,max:1,step:.01});i.addInput(n,"cpVarY",{min:0,max:.5,step:.01,label:"cp y var (wiggliness)"});i.addInput(n,"speed",{min:1e-4,max:.01,step:1e-4});n.addRecordOption&&i.addButton({title:"restart & record"}).on("click",()=>b(!0));i.addButton({title:"restart"}).on("click",()=>b());class Y{constructor({numLines:t=50,positions:r,startAt:e=0,color:a="rgba(255,255,255,0.1)"}){s(this,"numLines");s(this,"positions");s(this,"currentPetal",0);s(this,"currentLine",0);s(this,"petal");s(this,"done",!1);s(this,"startAt");s(this,"color");s(this,"draw",(t,r)=>{var e;if(!this.done&&!(r<this.startAt))if(this.currentLine<this.numLines)this.currentLine++,d.strokeStyle=this.color,(e=this.petal)==null||e.draw(t*n.speed);else{if(this.currentPetal>=this.positions.length-1){this.done=!0;return}this.currentLine=0,this.currentPetal++,this.petal=v(u,m,this.positions[this.currentPetal])}});this.numLines=t,this.positions=r,this.startAt=e,this.color=a,this.petal=v(u,m,this.positions[this.currentPetal])}}let h,w=0,p,L=[],g;d.lineWidth=.5;d.strokeStyle="rgba(255,255,255,0.1)";d.fillStyle="rgba(255,255,255,0.1)";function M(o){if(w++,L.every(t=>t.done)){p.stop(),h&&h.stop();return}L.forEach(t=>t.draw(o,w))}function v(o,t,r){let e=Math.min(o,t);return V(d,{x:o*.5,y:t*.5,controlRangeX:[e*.05,e*.15],endRangeY:[e*.4,e*.45],endRangeX:[e*-.05,e*.05],controlVarX:e*n.cpVarX,controlVarY:e*n.cpVarY,rotation:r})}function b(o=!1){p&&p.stop(),d.clearRect(0,0,u,m),w=0,g=Math.PI*2/n.numPetals;let t=[];for(let a=0;a<n.numPetals;a++)t.push(a*g);O(t);let e=t.length/n.drawAtOnce;for(let a=0;a<n.drawAtOnce;a++){let c=t.slice(a*e,(a+1)*e),f=n.numLines/n.drawAtOnce*(n.drawAtOnce-a-1);L.push(new Y({numLines:n.numLines,positions:c,startAt:f}))}o?h=S(I):h=null,p=x(M)}b();
