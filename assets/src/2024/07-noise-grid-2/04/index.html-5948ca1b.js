var B=Object.defineProperty;var G=(t,e,i)=>e in t?B(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var h=(t,e,i)=>(G(t,typeof e!="symbol"?e+"":e,i),i);import"../../../../modulepreload-polyfill-3cfb730f.js";import{l as q}from"../../../../loop-9a51de3b.js";import{R as W}from"../../../../trig-shapes-61ac4bbe.js";/* empty css                        */import{c as $}from"../../../../index-8d178fc0.js";import{c as Q}from"../../../../index-168b6c61.js";import{a as V}from"../../../../lil-gui.esm-da8e181f.js";import{S as X}from"../../../../sizes-34512445.js";import{s as Y}from"../../../../sort-colors-8885660c.js";import{r as P,d as F,s as j}from"../../../../utils-410b772c.js";import{N as H}from"../../../../node-40679d3e.js";import{a as J}from"../../../../simplex-noise-c4e77999.js";import"../../../../p5.min-89a01bf6.js";import"../../../../_commonjsHelpers-725317a4.js";import"../../../../_commonjs-dynamic-modules-302442b1.js";var y=Object.freeze({Linear:Object.freeze({None:function(t){return t},In:function(t){return t},Out:function(t){return t},InOut:function(t){return t}}),Quadratic:Object.freeze({In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}}),Cubic:Object.freeze({In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}}),Quartic:Object.freeze({In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}}),Quintic:Object.freeze({In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}}),Sinusoidal:Object.freeze({In:function(t){return 1-Math.sin((1-t)*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return .5*(1-Math.sin(Math.PI*(.5-t)))}}),Exponential:Object.freeze({In:function(t){return t===0?0:Math.pow(1024,t-1)},Out:function(t){return t===1?1:1-Math.pow(2,-10*t)},InOut:function(t){return t===0?0:t===1?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}}),Circular:Object.freeze({In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}}),Elastic:Object.freeze({In:function(t){return t===0?0:t===1?1:-Math.pow(2,10*(t-1))*Math.sin((t-1.1)*5*Math.PI)},Out:function(t){return t===0?0:t===1?1:Math.pow(2,-10*t)*Math.sin((t-.1)*5*Math.PI)+1},InOut:function(t){return t===0?0:t===1?1:(t*=2,t<1?-.5*Math.pow(2,10*(t-1))*Math.sin((t-1.1)*5*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin((t-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(t){var e=1.70158;return t===1?1:t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return t===0?0:--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?.5*(t*t*((e+1)*t-e)):.5*((t-=2)*t*((e+1)*t+e)+2)}}),Bounce:Object.freeze({In:function(t){return 1-y.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?y.Bounce.In(t*2)*.5:y.Bounce.Out(t*2-1)*.5+.5}}),generatePow:function(t){return t===void 0&&(t=4),t=t<Number.EPSILON?Number.EPSILON:t,t=t>1e4?1e4:t,{In:function(e){return Math.pow(e,t)},Out:function(e){return 1-Math.pow(1-e,t)},InOut:function(e){return e<.5?Math.pow(e*2,t)/2:(1-Math.pow(2-e*2,t))/2+.5}}}}),I=function(){return performance.now()},A=function(){function t(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,e)}return t.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(i){return e._tweens[i]})},t.prototype.removeAll=function(){this._tweens={}},t.prototype.add=function(){for(var e,i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];for(var n=0,a=i;n<a.length;n++){var s=a[n];(e=s._group)===null||e===void 0||e.remove(s),s._group=this,this._tweens[s.getId()]=s,this._tweensAddedDuringUpdate[s.getId()]=s}},t.prototype.remove=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];for(var r=0,n=e;r<n.length;r++){var a=n[r];a._group=void 0,delete this._tweens[a.getId()],delete this._tweensAddedDuringUpdate[a.getId()]}},t.prototype.allStopped=function(){return this.getAll().every(function(e){return!e.isPlaying()})},t.prototype.update=function(e,i){e===void 0&&(e=I()),i===void 0&&(i=!0);var r=Object.keys(this._tweens);if(r.length!==0)for(;r.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<r.length;n++){var a=this._tweens[r[n]],s=!i;a&&a.update(e,s)===!1&&!i&&this.remove(a)}r=Object.keys(this._tweensAddedDuringUpdate)}},t}(),C={Linear:function(t,e){var i=t.length-1,r=i*e,n=Math.floor(r),a=C.Utils.Linear;return e<0?a(t[0],t[1],r):e>1?a(t[i],t[i-1],i-r):a(t[n],t[n+1>i?i:n+1],r-n)},Bezier:function(t,e){for(var i=0,r=t.length-1,n=Math.pow,a=C.Utils.Bernstein,s=0;s<=r;s++)i+=n(1-e,r-s)*n(e,s)*t[s]*a(r,s);return i},CatmullRom:function(t,e){var i=t.length-1,r=i*e,n=Math.floor(r),a=C.Utils.CatmullRom;return t[0]===t[i]?(e<0&&(n=Math.floor(r=i*(1+e))),a(t[(n-1+i)%i],t[n],t[(n+1)%i],t[(n+2)%i],r-n)):e<0?t[0]-(a(t[0],t[0],t[1],t[1],-r)-t[0]):e>1?t[i]-(a(t[i],t[i],t[i-1],t[i-1],r-i)-t[i]):a(t[n?n-1:0],t[n],t[i<n+1?i:n+1],t[i<n+2?i:n+2],r-n)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=C.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:function(){var t=[1];return function(e){var i=1;if(t[e])return t[e];for(var r=e;r>1;r--)i*=r;return t[e]=i,i}}(),CatmullRom:function(t,e,i,r,n){var a=(i-t)*.5,s=(r-e)*.5,o=n*n,l=n*o;return(2*e-2*i+a+s)*l+(-3*e+3*i-2*a-s)*o+a*n+e}}},K=function(){function t(){}return t.nextId=function(){return t._nextId++},t._nextId=0,t}(),T=new A,L=function(){function t(e,i){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=y.Linear.None,this._interpolationFunction=C.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=K.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=e,typeof i=="object"?(this._group=i,i.add(this)):i===!0&&(this._group=T,T.add(this))}return t.prototype.getId=function(){return this._id},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isPaused=function(){return this._isPaused},t.prototype.getDuration=function(){return this._duration},t.prototype.to=function(e,i){if(i===void 0&&(i=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=i<0?0:i,this},t.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},t.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},t.prototype.start=function(e,i){if(e===void 0&&(e=I()),i===void 0&&(i=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var r in this._valuesStartRepeat)this._swapEndStartRepeatValues(r),this._valuesStart[r]=this._valuesStartRepeat[r]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||i){if(this._propertiesAreSetUp=!0,!this._isDynamic){var n={};for(var a in this._valuesEnd)n[a]=this._valuesEnd[a];this._valuesEnd=n}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,i)}return this},t.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},t.prototype._setupProperties=function(e,i,r,n,a){for(var s in r){var o=e[s],l=Array.isArray(o),d=l?"array":typeof o,f=!l&&Array.isArray(r[s]);if(!(d==="undefined"||d==="function")){if(f){var u=r[s];if(u.length===0)continue;for(var v=[o],w=0,O=u.length;w<O;w+=1){var M=this._handleRelativeValue(o,u[w]);if(isNaN(M)){f=!1,console.warn("Found invalid interpolation list. Skipping.");break}v.push(M)}f&&(r[s]=v)}if((d==="object"||l)&&o&&!f){i[s]=l?[]:{};var S=o;for(var b in S)i[s][b]=S[b];n[s]=l?[]:{};var u=r[s];if(!this._isDynamic){var N={};for(var b in u)N[b]=u[b];r[s]=u=N}this._setupProperties(S,i[s],u,n[s],a)}else(typeof i[s]>"u"||a)&&(i[s]=o),l||(i[s]*=1),f?n[s]=r[s].slice().reverse():n[s]=i[s]||0}}},t.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},t.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},t.prototype.pause=function(e){return e===void 0&&(e=I()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this)},t.prototype.resume=function(e){return e===void 0&&(e=I()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this)},t.prototype.stopChainedTweens=function(){for(var e=0,i=this._chainedTweens.length;e<i;e++)this._chainedTweens[e].stop();return this},t.prototype.group=function(e){return e?(e.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},t.prototype.remove=function(){var e;return(e=this._group)===null||e===void 0||e.remove(this),this},t.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},t.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},t.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},t.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},t.prototype.easing=function(e){return e===void 0&&(e=y.Linear.None),this._easingFunction=e,this},t.prototype.interpolation=function(e){return e===void 0&&(e=C.Linear),this._interpolationFunction=e,this},t.prototype.chain=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return this._chainedTweens=e,this},t.prototype.onStart=function(e){return this._onStartCallback=e,this},t.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},t.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},t.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},t.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},t.prototype.onStop=function(e){return this._onStopCallback=e,this},t.prototype.update=function(e,i){var r=this,n;if(e===void 0&&(e=I()),i===void 0&&(i=t.autoStartOnUpdate),this._isPaused)return!0;var a;if(!this._goToEnd&&!this._isPlaying)if(i)this.start(e,!0);else return!1;if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var s=e-this._startTime,o=this._duration+((n=this._repeatDelayTime)!==null&&n!==void 0?n:this._delayTime),l=this._duration+this._repeat*o,d=function(){if(r._duration===0||s>l)return 1;var M=Math.trunc(s/o),S=s-M*o,b=Math.min(S/r._duration,1);return b===0&&s===r._duration?1:b},f=d(),u=this._easingFunction(f);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,u),this._onUpdateCallback&&this._onUpdateCallback(this._object,f),this._duration===0||s>=this._duration)if(this._repeat>0){var v=Math.min(Math.trunc((s-this._duration)/o)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=v);for(a in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[a]=="string"&&(this._valuesStartRepeat[a]=this._valuesStartRepeat[a]+parseFloat(this._valuesEnd[a])),this._yoyo&&this._swapEndStartRepeatValues(a),this._valuesStart[a]=this._valuesStartRepeat[a];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=o*v,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var w=0,O=this._chainedTweens.length;w<O;w++)this._chainedTweens[w].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},t.prototype._updateProperties=function(e,i,r,n){for(var a in r)if(i[a]!==void 0){var s=i[a]||0,o=r[a],l=Array.isArray(e[a]),d=Array.isArray(o),f=!l&&d;f?e[a]=this._interpolationFunction(o,n):typeof o=="object"&&o?this._updateProperties(e[a],s,o,n):(o=this._handleRelativeValue(s,o),typeof o=="number"&&(e[a]=s+(o-s)*n))}},t.prototype._handleRelativeValue=function(e,i){return typeof i!="string"?i:i.charAt(0)==="+"||i.charAt(0)==="-"?e+parseFloat(i):parseFloat(i)},t.prototype._swapEndStartRepeatValues=function(e){var i=this._valuesStartRepeat[e],r=this._valuesEnd[e];typeof r=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(r):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=i},t.autoStartOnUpdate=!1,t}(),g=T;g.getAll.bind(g);g.removeAll.bind(g);g.add.bind(g);g.remove.bind(g);g.update.bind(g);class m extends H{constructor(i,{depth:r=0,parent:n=null,durationIn:a=500,durationOut:s=500,divideRule:o,delayEnter:l}={}){super(i,{depth:r,divideRule:o});h(this,"children",[]);h(this,"parent");h(this,"state","entering");h(this,"birthday",Date.now());h(this,"_progress",0);h(this,"_durationIn");h(this,"_durationOut");h(this,"tweenEnter");h(this,"tweenLeave");h(this,"tweenGroup");h(this,"data");this.parent=n,this.tweenEnter=new L(this).to({_progress:1},a),this.tweenEnter.easing(y.Cubic.Out),this.tweenEnter.onComplete(()=>{this.state="idle",this.birthday=Date.now()}),this._durationIn=a,this._durationOut=s,this.tweenLeave=new L(this).to({_progress:0},s),this.tweenLeave.easing(y.Cubic.In),this.tweenGroup=new A(this.tweenEnter,this.tweenLeave),l&&this.tweenEnter.delay(l),this.tweenEnter.start()}get progress(){return this._progress}get age(){return Date.now()-this.birthday}set durationIn(i){this._durationIn=i,this.tweenEnter.duration(i),this.children.forEach(r=>r.durationIn=i)}get durationIn(){return this._durationIn}get durationOut(){return this._durationOut}set durationOut(i){this._durationOut=i,this.tweenLeave.duration(i),this.getAll().forEach(r=>r.durationOut=i)}tick(i){this.tweenGroup.update(i)}divide(i){let r=this.divideRect();return r?(this.children=r.map((n,a)=>new m(n,{depth:this.depth+1,parent:this,durationIn:this.durationIn,durationOut:this.durationOut,divideRule:this.divideRule,delayEnter:i&&i*a})),this.tweenEnter.end(),!0):!1}collapse(){let i=super.collapse();return i&&(this.state="entering",this.tweenEnter.start()),i}isBusy(){return this.state!=="idle"}setWillDivide(i){return this.isBusy()||this.children.length>0?!1:(this.state="willDivide",this.tweenLeave.start(),new Promise(r=>{this.tweenLeave.onComplete(()=>{this.divide(i),this.state="idle",r()})}))}setWillCollapse(i){if(this.isBusy())return!1;if(this.children.length===0)return this.state="parentWillCollapse",i&&this.tweenLeave.delay(i),this.tweenLeave.start(),new Promise(s=>{this.tweenLeave.onComplete(()=>{s()})});let r=this.getLeaves();if(!!r.some(s=>s.state!=="idle"))return!1;let a=[];for(let s=0;s<r.length;s++){let l=r[s].setWillCollapse(i&&i*s);if(!l)return!1;a.push(l)}return this.state="willCollapse",Promise.all(a).then(()=>{this._progress=0,this.collapse()})}}class Z{constructor({bounds:e,...i}){h(this,"node");h(this,"bounds");h(this,"lastTime",0);h(this,"leaves",[]);h(this,"noise",J());h(this,"thresholdChange",.8);h(this,"divideRule","quarters-grid");h(this,"noiseVals",{});h(this,"noiseOptions");h(this,"maxDepth",5);h(this,"minDepth",3);h(this,"minLifeSpan",1800);h(this,"initTree",()=>{this.node.clear(),this.node.divideRule=this.divideRule;let e=this.bounds,i=P(e.x,e.x+e.width),r=P(e.y,e.y+e.height),n=this.node.getLeaves(),a=Math.min(...n.map(s=>s.depth));for(;a<this.minDepth;){let s=F(e.x,e.x+e.width,i),o=F(e.y,e.y+e.height,r),l=this.node.findNode(s,o);l&&l.depth<this.maxDepth&&l.divide(),n=this.node.getLeaves(),a=Math.min(...n.map(d=>d.depth))}this.refreshLeaves()});h(this,"divide",e=>{console.log("divide");let i=e.setWillDivide(this.node.durationIn*.25);return i?(i.then(()=>{this.refreshLeaves()}),!0):!1});h(this,"collapse",e=>{let i=e.parent,r=i==null?void 0:i.setWillCollapse(this.node.durationOut*.25);return r?(r.then(()=>{this.refreshLeaves()}),!0):!1});h(this,"draw",e=>{e.save(),this.leaves.forEach(i=>{let r=i.progress;e.fillStyle=`rgba(0, 0, 0, ${r})`,e.fillRect(i.bounds.x,i.bounds.y,i.bounds.width,i.bounds.height)}),e.restore()});h(this,"refreshLeaves",()=>{this.leaves=this.node.getLeaves()});this.bounds=e,this.noiseOptions={key:"default",freq:.64,speed:1.2,...i.noiseOptions||{}},i.divideRule&&(this.divideRule=i.divideRule),i.maxDepth&&(this.maxDepth=i.maxDepth),i.minDepth&&(this.minDepth=i.minDepth),i.thresholdChange&&(this.thresholdChange=i.thresholdChange),i.minLifeSpan&&(this.minLifeSpan=i.minLifeSpan),this.node=new m(e,{durationIn:i.nodeDurationIn,durationOut:i.nodeDurationOut})}tick(e,i){this.lastTime=e,this.draw(i),this.noiseVals={},this.leaves.forEach(r=>{var s;if(r.isBusy()||(s=r.parent)!=null&&s.isBusy()||r.age<this.minLifeSpan){r.tick(e);return}let n=this.getNoise(r,this.noiseOptions),a=this.thresholdChange;n>a&&r.depth<this.maxDepth?this.divide(r):n<-a&&r.depth>this.minDepth&&this.collapse(r),r.tick(e)})}getNoise(e,i=this.noiseOptions){let r=Math.round(e.bounds.x+e.bounds.width/2),n=Math.round(e.bounds.y+e.bounds.height/2),a=`${i.key}-${r}-${n}`;return a in this.noiseVals||(this.noiseVals[a]=this.calculateNoise(r,n,i)),this.noiseVals[a]}calculateNoise(e,i,{freq:r,speed:n}){let a=(typeof r=="number"?r:r.x)*.001,s=(typeof r=="number"?r:r.y)*.001,o=n*.001;return this.noise(e*a,i*s,this.lastTime*o)}}const _=new X;let{ctx:E,resizeCanvas:tt}=$(_.width,_.height);_.on("resize",tt);let R=Math.min(_.width,_.height)*.9,k=[["#081232","#bba0ca","#fff8e8","#fcd581","#d52941","#990d35"],["#fefaec","#f398c3","#cf3895","#a0d28d","#06b4b0","#fed000","#FF8552"],["#002e2d","#06b4b0","#cf3895","#fff8e8","#f398c3","#a0d28d","#ffd930","#FF8552"],["#331c25","#3c2e6b","#0081af","#a7d6c3","#285943","#8a8fbd","#9a79b8","#fcee49"]];const et=t=>{let e=[...k[t]];return e=j(e),{bg:e.shift(),palette:[...e]}};let D={getPalette:et,paletteIndex:Math.floor(P(k.length))},{bg:U,palette:z}=D.getPalette(D.paletteIndex);class x extends m{constructor(i,r={}){super(i,r);h(this,"tweenCircle");h(this,"circleProgress",0);this.tweenCircle=new L(this).to({circleProgress:1},this.durationIn*3),this.tweenCircle.easing(y.Elastic.InOut),this.tweenGroup.add(this.tweenCircle),this.tweenEnter.stop(),this.tweenEnter.onComplete(),this.tweenEnter.onEveryStart(()=>{this.tweenCircle.start()}),this.tweenEnter.start(),this.tweenCircle.onComplete(()=>{this.state="idle",this.birthday=Date.now()})}divide(i){let r=this.divideRect();return r?(this.children=r.map((n,a)=>new x(n,{depth:this.depth+1,parent:this,durationIn:this.durationIn,durationOut:this.durationOut,divideRule:this.divideRule,delayEnter:i&&i*a})),this.tweenEnter.end(),this.tweenCircle.end(),!0):!1}}class it extends Z{constructor(i){super(i);h(this,"colorRandomness",.2);h(this,"circleNum");h(this,"noiseOptsColor",{key:"colors",speed:.1,freq:1});h(this,"node");h(this,"leaves",[]);h(this,"circleStep",2);h(this,"colorMix","rgb");h(this,"_palette");h(this,"_colorSort");h(this,"sortPalette",()=>{this._colorSort==="random"?this._palette=j(this._palette):this._palette=Y(this._palette,this._colorSort)});h(this,"getLeafColors",i=>{let n=this.getNoise(i,this.noiseOptsColor)*.5+.5,a=this.getLeafData(i);n+=a.randomVal,n*=this.palette.length;let s=[];for(let l=0;l<this.circleNum;l++){let d=Math.floor(n+l)%this.palette.length;s.push(this.palette[d])}let o=[];o.push(this.palette[a.colorIndex]);for(let l=0;l<s.length-1;l++){let d=s[l],f=s[(l+1)%s.length],u=Q.mix(d,f,n%1,this.colorMix).hex();o.push(u)}return o});h(this,"getLeafDist",i=>this.getNoise(i,this.noiseOptsColor)*.5+.5);h(this,"getLeafData",i=>{if(!i.data){let r=P(this.colorRandomness),n=this.getNoise(i,this.noiseOptsColor),a=n*.5+.5;a+=r,a*=this.palette.length;let s=Math.floor(a)%this.palette.length;i.data={angle:n*Math.PI*2,colorIndex:s,randomVal:P(this.colorRandomness)}}return i.data});h(this,"draw",i=>{i.save(),this.leaves.forEach(r=>{let n=r.progress,a=this.getLeafColors(r),s=this.getLeafData(r).angle;i.save(),i.translate(r.bounds.x+r.bounds.width/2,r.bounds.y+r.bounds.height/2);let o=a.length,l;a.forEach((d,f)=>{let u=r.bounds.width*(1-f/(o+this.circleStep))*n*.5;u=Math.max(0,u);let v;if(l===void 0?v=0:v=l-u,l=u,f>0){let w=Math.cos(s)*v*(1-r.circleProgress),O=Math.sin(s)*v*(1-r.circleProgress);i.translate(w,O)}i.fillStyle=d,i.beginPath(),i.arc(0,0,u,0,Math.PI*2),i.fill()}),i.restore()})});this._palette=z,this._colorSort=i.colorSort||"random",this.colorRandomness=i.colorRandomness||.2,this.colorMix=i.colorMix||"rgb",this.circleNum=i.circleNum||3,this.node=new x(this.bounds,{durationIn:i.nodeDurationIn,durationOut:i.nodeDurationOut})}get colorSort(){return this._colorSort}set colorSort(i){this._colorSort=i,this.sortPalette()}set palette(i){this._palette=i,this.sortPalette()}get palette(){return this._palette}}let c=new it({palette:z,bounds:new W((_.width-R)/2,(_.height-R)/2,R,R),maxDepth:4,minDepth:2,thresholdChange:.6,noiseOptions:{speed:.2,freq:1},minLifeSpan:1500,nodeDurationIn:400,nodeDurationOut:300,divideRule:"quarters-grid",colorSort:"hue",colorRandomness:.31});const p=new V;p.add(c,"maxDepth",1,8,1);p.add(c,"minDepth",1,8,1);p.add(c,"thresholdChange",0,1,.01);p.add(c,"minLifeSpan",0,5e3,10);p.add(c,"colorSort",["hue","luminance","saturation","temperature","lightness","lightness-saturation","random"]);p.add(c.node,"durationIn",0,2e3,10).name("node duration in");p.add(c,"divideRule",["quarters-grid","half","two-random","two-thirds","thirds-row"]);p.add(c,"colorRandomness",0,1,.01);p.add(c,"colorMix",["rgb","lab","hsv","hsl","hsi"]);p.add(D,"paletteIndex",k.map((t,e)=>e)).onChange(t=>{let{bg:e,palette:i}=D.getPalette(t);c.palette=i,U=e});p.add(c,"initTree");p.close();c.initTree();function rt(t){E.clearRect(0,0,_.width,_.height),E.fillStyle=U,E.fillRect(0,0,_.width,_.height),c.tick(t,E)}q(rt);
