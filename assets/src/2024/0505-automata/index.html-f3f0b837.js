var q=Object.defineProperty;var F=(t,h,e)=>h in t?q(t,h,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[h]=e;var n=(t,h,e)=>(F(t,typeof h!="symbol"?h+"":h,e),e);import"../../../modulepreload-polyfill-3cfb730f.js";import{G as P}from"../../../lil-gui.esm-da8e181f.js";import{p as E}from"../../../p5.min-89a01bf6.js";/* empty css                     */import{C as x,V as c,R as w}from"../../../trig-shapes-61ac4bbe.js";import{m as T}from"../../../utils-410b772c.js";import"../../../_commonjsHelpers-725317a4.js";import"../../../_commonjs-dynamic-modules-302442b1.js";class b extends x{constructor(e,s,i,l={}){super(e,s,l.perception??25);n(this,"velocity");n(this,"acceleration");n(this,"flock");this.x=e,this.y=s,this.flock=i,this.velocity=new c,this.acceleration=new c}get perception(){return this._r}set perception(e){this.radius=e}update(){let e=this.velocity.copy().add(this.acceleration);this.velocity.lerp(e,.5).limit(this.flock.boidsMaxSpeed),this.add(this.velocity),this.acceleration.mult(0)}applyForce(e){let s=e.copy().div(this.flock.boidsMass);this.acceleration.add(s)}draw(e,s=!1,i=[0,0,0]){let l=Math.atan2(this.velocity.y,this.velocity.x);e.push(),e.translate(this.x,this.y),e.rotate(l),e.strokeWeight(2),e.fill(...i,100),e.stroke(...i),e.beginShape(),e.vertex(10,0),e.vertex(-10,-5),e.vertex(-10,5),e.endShape(e.CLOSE),s&&(e.noFill(),e.stroke(...i,50),e.circle(0,0,this.perception*2)),e.pop()}edgesBounce(e,s=this.perception/2){let i=null;if(this.x<s?i=new c(this.flock.boidsMaxSpeed,this.velocity.y):this.x>e.width-s&&(i=new c(-this.flock.boidsMaxSpeed,this.velocity.y)),this.y<s?i=new c(this.velocity.x,this.flock.boidsMaxSpeed):this.y>e.height-s&&(i=new c(this.velocity.x,-this.flock.boidsMaxSpeed)),i){i.setMag(this.flock.boidsMaxSpeed);let l=i.sub(this.velocity);return l.limit(this.flock.boidsMaxForce),l}else return new c}edgesTeleport(e,s=this.perception){this.x<-s?this.x=e.width+s:this.x>e.width+s&&(this.x=-s),this.y<-s?this.y=e.height+s:this.y>e.height+s&&(this.y=-s)}separation(e){let s=new c(0),i=0;for(let l of e){if(l===this)continue;let a=new c(this.x-l.x,this.y-l.y),d=a.copy().magSq();d>this.rSquared||(a.normalize().div(Math.sqrt(d)),s.add(a),i++)}return i===0||(s.div(i),s.setMag(this.flock.boidsMaxSpeed),s.sub(this.velocity),s.limit(this.flock.boidsMaxForce)),s}alignment(e){let s=new c,i=0;for(let a of e)a===this||this.copy().sub(a).magSq()>this.rSquared||(s.add(a.velocity),i++);if(i===0)return s;s.div(i),s.setMag(this.flock.boidsMaxSpeed);let l=s.copy().sub(this.velocity);return l.limit(this.flock.boidsMaxForce),l}cohesion(e){let s=new c,i=0;for(let l of e)l===this||this.copy().sub(l).magSq()>this.rSquared||(s.add(l),i++);return i===0?s:(s.div(i),this.seek(s))}seek(e,s=1){let i=e.copy().sub(this),l=i.mag();if(e instanceof x&&(l-=e.radius),l<100){let d=T(l,0,100,0,this.flock.boidsMaxSpeed);i.setMag(d)}else i.setMag(this.flock.boidsMaxSpeed);return i.sub(this.velocity).mult(s).limit(this.flock.boidsMaxForce)}flockWith(e,s,i="bounce",l={separate:1,cohere:1,align:1,bounds:1}){let a=this.separation(e).mult(l.separate),d=this.cohesion(e).mult(l.cohere),f=this.alignment(e).mult(l.align);if(this.applyForce(a),this.applyForce(d),this.applyForce(f),i==="bounce"){let m=this.edgesBounce(s).mult(l.bounds);this.applyForce(m)}else this.edgesTeleport(s)}}class y{constructor(h,e=4,s=0){n(this,"bounds");n(this,"capacity");n(this,"boids",[]);n(this,"ne",null);n(this,"nw",null);n(this,"se",null);n(this,"sw",null);n(this,"divided",!1);n(this,"depth",0);this.bounds=h,this.depth=s,this.capacity=e}insert(h){return this.bounds.contains(h.x,h.y)?this.boids.length<this.capacity?(this.boids.push(h),!0):(this.divided||(this.subdivide(),this.divided=!0),!!(this.ne.insert(h)||this.nw.insert(h)||this.se.insert(h)||this.sw.insert(h))):!1}subdivide(){let{x:h,y:e,width:s,height:i}=this.bounds,l=s/2,a=i/2;this.ne=new y(new w(h+l,e,l,a),this.capacity,this.depth+1),this.nw=new y(new w(h,e,l,a),this.capacity,this.depth+1),this.se=new y(new w(h+l,e+a,l,a),this.capacity,this.depth+1),this.sw=new y(new w(h,e+a,l,a),this.capacity,this.depth+1)}show(h){h.stroke(255),h.noFill(),h.rect(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height),this.ne&&this.ne.show(h),this.nw&&this.nw.show(h),this.se&&this.se.show(h),this.sw&&this.sw.show(h)}query(h){if(!this.bounds.intersects(h))return[];let e=[];return this.boids.forEach(s=>{h.contains(s.x,s.y)&&e.push(s)}),this.ne&&(e=e.concat(this.ne.query(h))),this.nw&&(e=e.concat(this.nw.query(h))),this.se&&(e=e.concat(this.se.query(h))),this.sw&&(e=e.concat(this.sw.query(h))),e}queryForSubdivisions(h){if(!this.bounds.intersects(h))return[];let e=[];return this.depth>0&&e.push(this),this.ne&&(e=e.concat(this.ne.queryForSubdivisions(h))),this.nw&&(e=e.concat(this.nw.queryForSubdivisions(h))),this.se&&(e=e.concat(this.se.queryForSubdivisions(h))),this.sw&&(e=e.concat(this.sw.queryForSubdivisions(h))),e}clear(){this.boids=[],this.divided=!1,this.ne=null,this.nw=null,this.se=null,this.sw=null}}class B{constructor(h,e,s){n(this,"boids",[]);n(this,"defaultPerception");n(this,"quadTree");n(this,"boidsMaxSpeed",3);n(this,"boidsMaxForce",.15);n(this,"boidsMass",1);n(this,"showPerception",!1);n(this,"showQuadTree",!1);n(this,"edgeMode","bounce");n(this,"highlight",!1);n(this,"mouse",new x(0,0,50));n(this,"useMouse",!1);n(this,"mouseStrength",.5);n(this,"mults",{separate:1,cohere:1,align:1,bounds:1});this.defaultPerception=s,this.quadTree=new y(h,e)}setBoidsPerception(h){this.defaultPerception=h,this.boids.forEach(e=>e.perception=h)}add(h){h?(h.flock=this,this.boids.push(h)):this.boids.push(new b(Math.random()*this.quadTree.bounds.width,Math.random()*this.quadTree.bounds.height,this,{perception:this.defaultPerception}))}update(){this.quadTree.clear(),this.boids.forEach(h=>{this.quadTree.insert(h)})}draw(h){this.boids.forEach(e=>e.draw(h,this.showPerception))}flock(h,e){this.boids.forEach((s,i)=>{let l=this.quadTree.query(s);if(s.flockWith(l,this.quadTree.bounds,this.edgeMode,this.mults),this.useMouse){let a=s.seek(this.mouse,this.mouseStrength);s.applyForce(a)}h&&h(s,i),s.update(),e&&e(s,i)})}}new E(t=>{let h,e=0,s=new P,i,l,a=0,d=new c,f={perception:20,add10:()=>{for(let o=0;o<10;o++)i.add()},remove10:()=>{for(let o=0;o<10;o++)i.boids.pop()},blendMode:t.BLEND};t.setup=function(){t.createCanvas(800,800);let o=t.width*.8,r=t.height*.8;i=new B(new w(0,0,o,r),4,50),i.mults.separate=1.5,i.edgeMode="teleport",i.defaultPerception=f.perception;for(let u=0;u<150;u++)i.add();d.x=o/2,d.y=r/2,S(s,i),l=t.createGraphics(t.width*.8,t.height*.8)};const m=o=>{let r=o.seek(d);o.applyForce(r);let u=Math.atan2(o.velocity.y,o.velocity.x);l.blendMode(f.blendMode),l.fill(o.x/l.width*200+50,Math.abs(u)*(255/Math.PI),o.y/l.height*100+150,o.velocity.mag()/i.boidsMaxSpeed*50),l.noStroke(),l.circle(o.x,o.y,30)},g=o=>{let r=Math.atan2(o.velocity.y,o.velocity.x);t.fill(o.x/l.width*200+50,Math.abs(r)*(255/Math.PI),o.y/l.height*100+150,o.velocity.mag()/i.boidsMaxSpeed*100),t.noStroke(),t.circle(o.x,o.y,30),i.showPerception&&(t.stroke(Math.abs(r)*(255/Math.PI),100,255),t.strokeWeight(1),t.noFill(),t.circle(o.x,o.y,o.perception*2))};t.draw=function(){let o=t.width*.8,r=t.height*.8;t.background(230),t.push(),t.translate((t.width-o)/2,(t.height-r)/2);let u=t.millis()*.001,v=Math.cos(u*.5+Math.sin(u*.5)),k=Math.sin(u-Math.cos(v*.5*u));d.x=v*(o*.6)+o/2,d.y=k*(r*.6)+o/2,t.image(l,0,0),t.stroke(0),t.strokeWeight(2),t.noFill(),t.rect(0,0,o,r);let M=t.drawingContext;M.beginPath(),M.rect(0,0,o,r),M.clip(),t.mouseIsPressed&&t.millis()-a>100&&(i.add(new b(t.mouseX-(t.width-o)/2,t.mouseY-(t.height-r)/2,i)),a=t.millis()),i.update(),i.flock(m,g),t.stroke(0),t.strokeWeight(3),t.noFill(),t.circle(d.x,d.y,20),i.useMouse&&t.noFill().stroke(0).strokeWeight(3).circle(i.mouse.x,i.mouse.y,i.mouse.radius*2),t.pop(),p()},t.keyPressed=function(){console.log(t.key,t.keyCode),t.keyCode===32&&(i.useMouse=!i.useMouse)},t.mouseMoved=function(){i.mouse.x=t.mouseX-(t.width-l.width)/2,i.mouse.y=t.mouseY-(t.height-l.height)/2},t.mousePressed=function(){i.add(new b(i.mouse.x,i.mouse.y,i))};function S(o,r){o.close(),o.add(r.mults,"separate",0,5,.1),o.add(r.mults,"cohere",0,5,.1),o.add(r.mults,"align",0,5,.1),o.add(r.mults,"bounds",0,5,.1),o.add(f,"perception",0,200,1).onChange(u=>{r.setBoidsPerception(u)}),o.add(r,"boidsMaxForce",0,1,.01),o.add(r,"boidsMass",0,5,.1),o.add(r,"boidsMaxSpeed",0,10,.1),o.add(r,"showPerception"),o.add(r,"showQuadTree"),o.add(r,"edgeMode",["teleport","bounce"]),o.add(f,"add10"),o.add(f,"remove10"),o.add(f,"blendMode",[t.OVERLAY,t.MULTIPLY,t.DARKEST,t.LIGHTEST,t.DIFFERENCE,t.EXCLUSION,t.HARD_LIGHT,t.SOFT_LIGHT,t.OVERLAY,t.DODGE,t.BURN,t.ADD,t.BLEND])}function p(){t.fill(0),t.noStroke(),t.text(h,10,20),t.millis()-e>250&&(h=t.frameRate().toFixed(0),e=t.millis())}},document.getElementById("sketch")??void 0);
