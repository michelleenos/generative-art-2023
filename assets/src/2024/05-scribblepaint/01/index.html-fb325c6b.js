var m=Object.defineProperty;var f=(l,e,t)=>e in l?m(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var n=(l,e,t)=>(f(l,typeof e!="symbol"?e+"":e,t),t);import"../../../../modulepreload-polyfill-3cfb730f.js";import{G as L}from"../../../../lil-gui.esm-da8e181f.js";import{p}from"../../../../p5.min-89a01bf6.js";import{D as x}from"../../../../data-view-d08f0f9a.js";import{c as u}from"../../../../index-168b6c61.js";import{e as P}from"../../../../easings-ac43f515.js";import{r as g}from"../../../../utils-410b772c.js";import{s as M}from"../../../../sort-colors-8885660c.js";import{R as A}from"../../../../trig-shapes-61ac4bbe.js";import{r as R,a as C,p as S,b as c,s as k}from"../../../../utils-69a93949.js";import{R as v}from"../../../../recorder-e49c81e7.js";import{b as I}from"../../../../05backgrounds-6f659a2d.js";import"../../../../_commonjsHelpers-725317a4.js";import"../../../../_commonjs-dynamic-modules-302442b1.js";import"../../../../dom-07b9d998.js";import"../../../../canvas-images-d0bfdd66.js";import"../../../../jszip.min-f5692425.js";/* empty css                        */import"../../../../index-8d178fc0.js";import"../../../../simplex-noise-c4e77999.js";function b(l,e){return Math.pow(l[0]-e[0],2)+Math.pow(l[1]-e[1],2)}const D=()=>({done:!1,doneAdding:!1,colorIndex:0,linesDrawn:0,longLines:[],failsCount:0,lastPoint:null,longLinesSaved:[],redrawing:!1,redrawnCount:0,_currentLine:[],_currentLineLength:0});class y{constructor(e,t){n(this,"g");n(this,"width");n(this,"height");n(this,"rect");n(this,"pd");n(this,"palette");n(this,"currentPalette");n(this,"stepRate",2e3);n(this,"stepMult",1);n(this,"alphaThreshold",150);n(this,"longLineRatio",.4);n(this,"lineWidth",3);n(this,"newPixelRadius",50);n(this,"newPixelMethod","random");n(this,"len",{minStart:20,minEnd:10,minReduceBy:2,maxForColor:500,max:500});n(this,"redraw",!1);n(this,"wiggle",{withinLine:.05,onLinePointFail:.05,betweenLine:.05,nLines:100,max:0,dir:void 0});n(this,"failsUntil",{stop:1e3,moveLook:15,forceMoveLook:100,reduceMinLen:200});n(this,"tries",{pixel:10,linePoint:10});n(this,"colors",{sort:"none",pattern:"step",move:1e-4,mixSpace:"hsl",sortDir:"+",shadowAmt:0,shadowAlpha:0,shadowOffset:[0,0]});n(this,"state",{_currentLineLength:0,_currentLine:[],linesDrawn:0,lineLookPoint:[0,0],lastPoint:null,longLines:[],angle:0,lineAngle:0,redrawnCount:0,redrawing:!1,longLinesSaved:[],done:!1,doneAdding:!1,colorIndex:0,failsCount:0,currentMinLen:this.len.minStart});this.width=e.width,this.height=e.height,this.rect=new A(0,0,this.width,this.height),this.pd=t.pd,this.g=e,this.g.pixelDensity(this.pd),this.loadPixels(),this.state.angle=Math.random()*Math.PI*2,this.state.lineAngle=this.state.angle,this.state.lineLookPoint=[Math.floor(g(this.width)),Math.floor(g(this.height))],this.palette=t.palette,this.sortColors()}get done(){return this.state.done}setLine(e=[],t=!1){!t&&e.length>2&&b(e[0],e[e.length-1])>(this.width*this.longLineRatio)**2&&(this.state.longLines.push([...e]),this.state.longLinesSaved.push([...e])),this.state.lastPoint=null,this.state._currentLine=[...e],this.state._currentLineLength=this.state._currentLine.length,this.state.failsCount=0}sortColors(){this.currentPalette=[...this.palette],this.colors.sort!=="none"&&(this.currentPalette=M(this.currentPalette,this.colors.sort,this.colors.sortDir))}maybeGetNewPixel(){let[e,t]=this.state.lineLookPoint,i=0;for(;i<this.tries.pixel;){let[s,a]=this.newPixelMethod==="circle"?R(e,t,this.newPixelRadius):this.newPixelMethod==="rect"?C(e,t,this.newPixelRadius):this.rect.getRandom();if(this.rect.contains(s,a)&&this.isBlankIshPx(s,a))return[s,a];i++}return!1}isBlankIshPx(e,t){let i=S(Math.round(e),Math.round(t),this.width,this.pd);return this.g.pixels[i+3]<this.alphaThreshold}getLinePoints(e,t){let i=e,s=t,a=[],d=0;for(;a.length<this.len.max&&d<this.tries.linePoint;){let h=i+Math.cos(this.state.lineAngle)*this.stepMult,o=s+Math.sin(this.state.lineAngle)*this.stepMult;if(h<0||h>=this.width||o<0||o>=this.height)break;if(!this.isBlankIshPx(h,o))this.state.lineAngle+=c(this.wiggle.onLinePointFail),d++;else{a.push([i,s]),i=h,s=o;let r=this.state.lineAngle-this.state.angle;this.wiggle.max>0&&Math.abs(r)>this.wiggle.max?this.state.lineAngle+=g(this.wiggle.withinLine)*(r>0?-1:1):this.state.lineAngle+=c(this.wiggle.withinLine),d=0}}return a.length<this.state.currentMinLen?!1:a}addFail(){let e=this.state;if(e.failsCount++,e.failsCount>this.failsUntil.moveLook&&e.longLines.length){let t=e.longLines.shift();e.lineLookPoint=t[Math.floor(t.length/2)]}else e.failsCount>this.failsUntil.forceMoveLook&&(e.lineLookPoint=this.rect.getRandom());e.failsCount>this.failsUntil.reduceMinLen&&(this.state.currentMinLen=Math.max(this.state.currentMinLen-this.len.minReduceBy,this.len.minEnd)),e.failsCount>this.failsUntil.stop&&this.state.currentMinLen===this.len.minEnd&&(e.doneAdding=!0,e.longLinesSaved.sort((t,i)=>i.length-t.length),e.redrawnCount=0)}maybeGetNewLine(){for(;;){let e=this.maybeGetNewPixel();if(!e)break;let[t,i]=e,s=this.getLinePoints(t,i);if(!s)break;return this.setLine(s),!0}return this.addFail(),!1}finishLine(){this.state.linesDrawn++,this.loadPixels(),this.setLine(),this.state.linesDrawn%this.wiggle.nLines===0&&this.getNewAngle(),this.state.lineAngle=this.state.angle,this.redraw&&this.state.linesDrawn>this.redraw.after&&this.state.linesDrawn%this.redraw.rate===0&&this.state.redrawnCount<this.state.longLinesSaved.length*this.redraw.maxMult&&this.doRedraw()}getNewAngle(){this.state.angle+=c(this.wiggle.betweenLine,this.wiggle.dir)}doRedraw(){this.state.redrawing=!0,this.state.redrawnCount++,this.setLine(this.state.longLinesSaved[this.state.redrawnCount%this.state.longLinesSaved.length],!0)}doEndRedraw(){this.redraw&&this.state.redrawnCount<this.state.longLinesSaved.length?this.doRedraw():this.state.done=!0}setColor(){let e;if(this.colors.pattern==="step"){this.state.colorIndex+=this.colors.move,this.state.colorIndex>=this.currentPalette.length&&(this.state.colorIndex=0);let t=this.currentPalette[Math.floor(this.state.colorIndex)],i=this.currentPalette[Math.ceil(this.state.colorIndex)];i||(i=this.currentPalette[0]),e=u.mix(t,i,this.state.colorIndex%1,this.colors.mixSpace)}else{let t=this.state._currentLineLength,i=Math.min(this.len.maxForColor,this.len.max),s=(t-this.len.minEnd)/(i-this.len.minEnd);s=P.outQuart(s),e=u(this.currentPalette[Math.floor(s*(this.currentPalette.length-1))])}if(this.colors.shadowAmt){let t=e.alpha(this.colors.shadowAlpha).hex();k(this.g,t,this.lineWidth*this.colors.shadowAmt,this.colors.shadowOffset)}this.g.stroke(e.hex()),this.g.strokeWeight(this.lineWidth)}lineStep(){if(this.state._currentLine.length<2)return;let[e,t]=this.state.lastPoint??this.state._currentLine[0];this.setColor();let[i,s]=this.state._currentLine[1];this.g.line(e,t,i,s),this.state.lastPoint=[i,s],this.state._currentLine.shift(),this.state._currentLine.length<2&&this.finishLine()}update(e){let t=Math.round(e/1e3*this.stepRate);for(;t>0&&!this.state.done;){if(this.state._currentLine.length>=2){this.lineStep(),t--;continue}if(this.state.doneAdding?this.doEndRedraw():this.maybeGetNewLine(),this.state.done)break}return this.state.done}loadPixels(){this.g.loadPixels()}reset(e,t){this.g.clear(),this.loadPixels(),this.sortColors();let i=e||Math.random()*Math.PI*2,s=t||this.rect.getRandom();this.state={...D(),angle:i,lineAngle:i,lineLookPoint:s,currentMinLen:this.len.minStart}}}let _=["#874286","#fc814a","#f9c8ce","#b6cccc"],E=new x,U=new L;new p(l=>{let e,t,i,s,a;function d(){i=700,s=Math.floor(i*.7)}function h(r){return o(20)}function o(r){return t.update(r),l.clear(),l.push(),l.noStroke(),l.drawingContext.drawImage(a,0,0,i,i),l.image(e,0,0,i,i),E.update(),t.done}l.setup=function(){d();let r=l.createCanvas(i,i);new v({canvas:r.elt,fns:{drawRecord:h,draw:o,reset:()=>t.reset()},gui:U}),e=l.createGraphics(s,s),a=I(i,200,90);let w=Math.min(l.pixelDensity(),2);t=new y(e,{pd:w,palette:_}),t.stepRate=5e3,t.stepMult=1,t.colors.pattern="step",t.alphaThreshold=245,t.lineWidth=4,t.colors.move=1e-4,t.colors.shadowAmt=1,t.colors.shadowAlpha=.1,t.len.minStart=40,t.len.minEnd=15,t.len.minReduceBy=1,t.len.max=1e3,t.longLineRatio=.5,t.colors.sort="luminance",t.colors.move=1e-4,t.colors.mixSpace="hsl",t.colors.sortDir="+",t.colors.shadowAmt=2,t.colors.shadowAlpha=.5,t.colors.pattern="length",t.redraw=!1,t.newPixelMethod="circle",t.newPixelRadius=100,t.wiggle.withinLine=.1,t.wiggle.onLinePointFail=.15,t.wiggle.betweenLine=.01,t.wiggle.nLines=400,t.wiggle.max=3,t.failsUntil.moveLook=15,t.failsUntil.reduceMinLen=1500,t.failsUntil.stop=2e3,t.tries.pixel=30,t.tries.linePoint=55,t.reset(),l.noLoop()}},document.getElementById("sketch")??void 0);
