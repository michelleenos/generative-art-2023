var O=Object.defineProperty;var G=(h,e,i)=>e in h?O(h,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):h[e]=i;var c=(h,e,i)=>(G(h,typeof e!="symbol"?e+"":e,i),i);import"../../../../modulepreload-polyfill-3cfb730f.js";import{G as W}from"../../../../lil-gui.esm-da8e181f.js";import{a as j}from"../../../../simplex-noise-c4e77999.js";import{e as R}from"../../../../easings-ac43f515.js";import{l as B}from"../../../../loop-9a51de3b.js";import{R as m}from"../../../../trig-shapes-61ac4bbe.js";import{l as H}from"../../../../shapes-52b2702a.js";import{S as U}from"../../../../sizes-34512445.js";import{d as C,m as P,c as E}from"../../../../utils-410b772c.js";/* empty css                        */import{c as V}from"../../../../index-8d178fc0.js";import"../../../../p5.min-89a01bf6.js";import"../../../../_commonjsHelpers-725317a4.js";import"../../../../_commonjs-dynamic-modules-302442b1.js";class w{constructor(e,i=4,n=0,d=null){c(this,"bounds");c(this,"capacity");c(this,"depth");c(this,"children",[]);c(this,"points",[]);c(this,"parent",null);c(this,"_maxDepth",null);c(this,"_count",null);this.bounds=e,this.depth=n,this.capacity=i,this._maxDepth=n,this._count=0,d&&(this.parent=d)}get count(){return this._count===null&&(this._count=this.children.reduce((e,i)=>e+i.count,this.points.length)),this._count}get maxDepth(){if(this._maxDepth===null){let e=this.depth;this.children.forEach(i=>{e=Math.max(e,i.maxDepth)}),this._maxDepth=e}return this._maxDepth}insert(e){if(this._count=null,!this.bounds.contains(e))return!1;if(this.points.length<this.capacity)return this.points.push(e),!0;this.children.length===0&&this.subdivide();for(let i=0;i<this.children.length;i++)if(this.children[i].insert(e))return!0;return!1}subdivide(){this._maxDepth=null;let{x:e,y:i,width:n,height:d}=this.bounds,u=n/2,f=d/2,x=new w(new m(e+u,i,u,f),this.capacity,this.depth+1,this),r=new w(new m(e,i,u,f),this.capacity,this.depth+1,this),y=new w(new m(e+u,i+f,u,f),this.capacity,this.depth+1,this),S=new w(new m(e,i+f,u,f),this.capacity,this.depth+1,this);this.children=[x,r,y,S]}getLeafNodes(){let e=[];return this.children.forEach(i=>{let n=i.getLeafNodes();e.push(...n)}),e.length===0&&e.push(this),e}query(e){if(!this.bounds.intersects(e))return[];let i=[];for(let n of this.points)e.contains(n)&&i.push(n);return this.children.forEach(n=>{i.push(...n.query(e))}),i}getAllPoints(){let e=[...this.points];return this.children.forEach(i=>{e.push(...i.getAllPoints())}),e}rebuild(){let e=this.getAllPoints();this.clear(),e.forEach(i=>this.insert(i)),this._maxDepth=null}unSubdivide(){if(this.children.length!==0){for(;this.children.length;){let e=this.children.pop();this.points.push(...e.getAllPoints())}this._count=null,this._maxDepth=this.depth}}clear(){this.points=[],this.children=[],this._count=null,this._maxDepth=this.depth}}let F=j();const a=new U;let{ctx:s,canvas:$,resizeCanvas:J}=V(a.width,a.height);const T=new W;let l=Math.min(a.width,a.height)*.9,z=["#25ced1","#2c4251","#b288c0"],M=["#f17300","#2c4251","#25ced1"],Y=[],g=new w(new m(0,0,a.width,a.height),4),X=[],k;const t={influence:.5,biasX:.9,biasY:.5,count:1e3,drawThreshold:0,reduceSize:.3,reducePower:3,noiseSpeed:.3,noiseFreq1:.7,noiseFreq2:1,stepSeconds:1.4,stepChangeDuration:.5,stepChangeEase:"outQuart"};function K(){let h=[];for(let e=0;e<t.count;e++){let i=C(0,l,l*t.biasX,t.influence),n=C(0,l,l*t.biasY,t.influence);h.push([i,n])}return h}$.addEventListener("click",h=>{let e=(a.width-l)/2,i=(a.height-l)/2,n=(h.clientX-e)/l,d=(h.clientY-i)/l;t.biasX=n,t.biasY=d,_()});function Z(h){let e=l/Math.pow(2,k)*.1,i=h/t.stepSeconds/1e3,n=i%1,d=Math.floor(i);n>1-t.stepChangeDuration?i=d+R[t.stepChangeEase](P(n,1-t.stepChangeDuration,1,0,1)):i=d,s.clearRect(0,0,a.width,a.height),s.fillStyle="#fffbf4",s.fillRect(0,0,a.width,a.height),s.save(),s.translate((a.width-l)/2,(a.height-l)/2),s.strokeStyle="#121212",s.lineWidth=3,s.strokeRect(-1.5,-1.5,l+3,l+3),X.forEach((f,x)=>{let r=f.bounds,y=r.x+r.width/2,S=r.y+r.height/2,D=y/l,q=S/l,A=F(D*t.noiseFreq1,q*t.noiseFreq2,i*t.noiseSpeed),L=F(D*t.noiseFreq2,q*t.noiseFreq1,i*-t.noiseSpeed),v=Math.max(A,L);if(v>t.drawThreshold){let o=P(v,t.drawThreshold+t.reduceSize,t.drawThreshold,1,0);if(o=E(o,0,1),o=Math.pow(o,t.reducePower),r.width<e||r.height<e)return;let N=F(D*t.noiseFreq1,q*t.noiseFreq2,0)>0?"l":"r",I=(F(D*t.noiseFreq2,q*t.noiseFreq1,0)>0?"t":"b")+N;s.fillStyle=z[x%z.length],s.save(),s.translate(r.x+e/2,r.y+e/2),H(s,{w:r.width-e,h:r.height-e,corner:I,progress:o}),s.fill(),s.restore()}else{let o=P(v,t.drawThreshold,t.drawThreshold-t.reduceSize,0,1);if(o=E(o,0,1),o=Math.pow(o,t.reducePower),r.width<e||r.height<e)return;s.fillStyle=M[x%M.length],s.save(),s.translate(y+e/2,S+e/2),s.beginPath(),s.arc(0,0,(r.width-e)*.5*o,0,Math.PI*2),s.fill(),s.restore()}});let u=g.count;s.fillStyle="#121212",s.fillText(`Count: ${u}`,10,20),s.restore()}function _(){g.clear(),g.bounds=new m(0,0,l,l),Y=K(),Y.forEach(h=>g.insert(h)),X=g.getLeafNodes(),k=g.maxDepth}a.on("resize",(h,e)=>{J(h,e),l=Math.min(h,e)*.9,_()});let b=T.addFolder("quadtree points");b.add(t,"influence",0,2).step(.01);b.add(t,"biasX",0,1).step(.01).listen();b.add(t,"biasY",0,1).step(.01).listen();b.add(t,"count",1,4e3).step(1);b.onChange(_);let p=T.addFolder("shapes");p.add(t,"reduceSize",0,1).step(.01);p.add(t,"drawThreshold",-1,1).step(.01);p.add(t,"reducePower",.01,10).step(.01);p.add(t,"noiseSpeed",.01,1).step(.01);p.add(t,"noiseFreq1",.1,4).step(.01);p.add(t,"noiseFreq2",.1,4).step(.01);p.add(t,"stepSeconds",.1,10).step(.1);p.add(t,"stepChangeDuration",.1,1).step(.1);p.add(t,"stepChangeEase",Object.keys(R));_();B(Z);
