var z=Object.defineProperty;var W=(a,e,i)=>e in a?z(a,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[e]=i;var s=(a,e,i)=>(W(a,typeof e!="symbol"?e+"":e,i),i);import"../../../../modulepreload-polyfill-3cfb730f.js";import{c as G}from"../../../../index-8d178fc0.js";import{l as V}from"../../../../loop-9a51de3b.js";import{S as j}from"../../../../sizes-34512445.js";/* empty css                        */import{a as N}from"../../../../alea-811168f2.js";import{c as U}from"../../../../index-168b6c61.js";import{a as X}from"../../../../simplex-noise-c4e77999.js";import{r as T,m as O,d as L}from"../../../../utils-410b772c.js";import{T as Y}from"../../../../timer-edf95207.js";import{R as C}from"../../../../trig-shapes-61ac4bbe.js";import{a as H}from"../../../../lil-gui.esm-da8e181f.js";import{e as A}from"../../../../easings-ac43f515.js";import{g as S,a as B,m as P}from"../../../../helpful-stuff-36d8f740.js";import"../../../../jszip.min-f5692425.js";import"../../../../_commonjsHelpers-725317a4.js";import"../../../../p5.min-89a01bf6.js";import"../../../../_commonjs-dynamic-modules-302442b1.js";const t={minDepth:2,maxDepth:5,delayMin:50,delayMax:400,durationIn:1500,durationOut:1500,eachAmount:.3,noiseFreqDiv:2,noiseSpeedDiv:4,noiseFreqColor:1,noiseSpeedColor:.05,noiseFreqAngle:.1,noiseSpeedAngle:.1,rootSize:200,innerRadiusAmt:.7,layers:3,colorsDist:.2,threshold:.7,minAge:0,randomness:.2,layersMag:2,easeIn:"outCirc",easeOut:"outCirc"},J=a=>{a.in=S({durationTotal:t.durationIn,durationEach:t.durationIn*t.eachAmount,steps:t.layers}),a.out=S({durationTotal:t.durationOut,durationEach:t.durationOut*t.eachAmount,steps:t.layers})},q={in:S({durationTotal:t.durationIn,durationEach:t.durationIn*t.eachAmount,steps:t.layers}),out:S({durationTotal:t.durationOut,durationEach:t.durationOut*t.eachAmount,steps:t.layers})},K=()=>{const a=new H().close();a.add(t,"minDepth",1,5,1),a.add(t,"maxDepth",1,9,1),a.add(t,"delayMin",0,1500,10),a.add(t,"delayMax",0,1500,10);let e=a.addFolder(".");e.add(t,"layers",1,6,1),e.add(t,"durationIn",0,5e3,10),e.add(t,"durationOut",0,5e3,10),e.add(t,"eachAmount",0,1,.01),e.onChange(()=>{J(q)}),a.add(t,"noiseFreqDiv",0,4,.01),a.add(t,"noiseSpeedDiv",0,4,.01),a.add(t,"noiseFreqColor",0,2,.01),a.add(t,"noiseSpeedColor",0,2,.01),a.add(t,"noiseFreqAngle",0,2,.01),a.add(t,"noiseSpeedAngle",0,2,.01),a.add(t,"innerRadiusAmt",0,1,.01),a.add(t,"colorsDist",0,1,.01),a.add(t,"threshold",0,1,.01).listen(),a.add(t,"minAge",0,5e3,10),a.add(t,"randomness",0,1,.01),a.add(t,"layersMag",0,10,.01);let i=Object.keys(A);return a.add(t,"easeIn",i),a.add(t,"easeOut",i),a};let Q=0;class w{constructor(e,i,r=0){s(this,"bounds");s(this,"parent");s(this,"children");s(this,"vals");s(this,"timer",null);s(this,"depth");s(this,"birthday");s(this,"stage");s(this,"randomVal");s(this,"cellId");s(this,"lastTime",0);s(this,"delayEnter");s(this,"onDivide");s(this,"onCollapse");s(this,"newBirthday",()=>{this.birthday=this.lastTime});s(this,"update",e=>{this.lastTime=e});s(this,"getAge",e=>this.birthday===-1?-1:e-this.birthday);s(this,"findCell",(e,i)=>{if(this.bounds.contains(e,i)){for(let r of this.children){let n=r.findCell(e,i);if(n)return n}return this}return!1});s(this,"getLeaves",()=>{let e=[];if(this.children.length===0)e.push(this);else for(let i of this.children)e.push(...i.getLeaves());return e});s(this,"flattenCells",()=>{let e=[this];for(let i of this.children)e.push(...i.flattenCells());return e});s(this,"makeTweens",(e=0,i)=>{let r=this.stage==="in"?t.durationIn:t.durationOut;this.timer=new Y({duration:r,easing:"linear"}).delay(e),this.stage==="out"&&this.timer.reverse(1),i&&this.timer.onComplete(i)});s(this,"enter",()=>{this.stage="in",this.makeTweens(this.delayEnter,()=>{this.stage="idle",this.newBirthday()})});s(this,"canDivide",()=>this.stage==="idle"&&this.children.length===0);s(this,"canCollapse",()=>!this.children.some(e=>e.stage!=="idle"||e.children.length>0));s(this,"divide",()=>{let{x:e,y:i,width:r,height:n}=this.bounds,l=r/2,o=n/2;return this.stage="idle",this.children.push(new w(new C(e,i,l,o),this,this.getDelay()),new w(new C(e+l,i,l,o),this,this.getDelay()),new w(new C(e,i+o,l,o),this,this.getDelay()),new w(new C(e+l,i+o,l,o),this,this.getDelay())),this.onDivide&&this.onDivide(this),!0});s(this,"collapse",()=>{this.children=[],this.birthday=-1,this.stage="in",this.makeTweens(0,()=>{this.stage="idle",this.newBirthday(),this.removeTween()}),this.onCollapse&&this.onCollapse(this)});s(this,"setWillDivide",()=>this.canDivide()?(this.stage="out",this.makeTweens(0,()=>{this.stage="idle",this.removeTween(),this.divide()}),!0):!1);s(this,"setWillCollapse",(e=0)=>{if(!this.canCollapse())return!1;if(this.children.length===0)return new Promise(i=>{this.stage="out",this.makeTweens(e,()=>{this.stage="hidden",this.removeTween(),i()})});{let i=[];for(let r=0;r<this.children.length;r++){let l=this.children[r].setWillCollapse(this.getDelay());if(!l)return!1;i.push(l)}return this.stage="childrenOut",this.removeTween(),this.vals.progress=0,Promise.all(i).then(()=>{this.collapse()})}});s(this,"removeTween",()=>{this.timer=null});s(this,"getDelay",()=>T(t.durationIn*.2,t.durationIn*.8));this.bounds=e,this.parent=i,this.stage="in",this.children=[],this.vals={progress:0},this.timer=null,this.depth=i?i.depth+1:0,this.birthday=-1,this.delayEnter=r,this.randomVal=T(-t.randomness/2,t.randomness/2),this.cellId=++Q}get progress(){return this.timer?this.timer.progress:this.stage==="idle"?1:0}}const Z=(a,e,i)=>{let r=850,n=new C((a.width-r)/2,(a.height-r)/2,r,r),l=new w(n),o=l.getLeaves(),g=o.filter(p=>p.depth<e).length,h=o.filter(p=>p.depth===i).length,u=T(n.width*.25,n.width*.75)+n.x,m=T(n.width*.25,n.height*.75)+n.y;for(;g>0||h<5;){let p=L(n.x,n.x+n.width,u,.6),D=L(n.y,n.y+n.height,m,.6),f=l.findCell(p,D);f&&f.depth<i&&f.divide();let c=l.getLeaves();h=c.filter(y=>y.depth===i).length,g=c.filter(y=>y.depth<e).length}return l};class ${constructor(e,i){s(this,"root");s(this,"width");s(this,"height");s(this,"noise");s(this,"leaves");s(this,"palette",["#7051b5","#cf3895","#fed000","#ff8552"]);s(this,"scale");s(this,"lastTime",0);s(this,"updateLeaves",()=>{this.leaves=this.root.getLeaves(),this.leaves.forEach(e=>{!e.timer&&e.stage==="in"&&e.enter()})});s(this,"update",e=>{let i=e-this.lastTime;this.lastTime=e;let r=B(t,["noiseSpeedDiv","noiseFreqDiv"]),{noiseFreqDiv:n,noiseSpeedDiv:l}=P(r,.001);this.leaves.forEach(o=>{if(o.timer&&o.timer.tick(i),o.stage!=="idle"||o.getAge(e)<t.minAge)return;let g=o.bounds.x+o.bounds.width/2,h=o.bounds.y+o.bounds.height/2,u=this.noise(g*n,h*n,e*l);if(u>t.threshold&&o.depth<t.maxDepth)o.setWillDivide();else if(u<-t.threshold&&o.depth>t.minDepth){let m=o.parent;m&&m.setWillCollapse()}})});s(this,"draw",(e,i)=>{this.update(e),i.fillStyle="#f6eec7",i.fillRect(0,0,this.width,this.height);let r=B(t,["noiseFreqColor","noiseSpeedColor","noiseFreqAngle","noiseSpeedAngle"]),{noiseFreqColor:n,noiseSpeedColor:l,noiseSpeedAngle:o,noiseFreqAngle:g}=P(r,.001);this.updateLeaves(),this.leaves.forEach(h=>{let u=h.progress;if(u===0)return;let m=h.bounds.width/2,p=m*t.innerRadiusAmt,D=h.bounds.x+h.bounds.width/2,f=h.bounds.y+h.bounds.height/2,c=this.noise(D*n,f*n,e*l);c=O(c,0,1,t.randomness,1-t.randomness-t.colorsDist),c+=h.randomVal;let y=this.noise(D*g,f*g,e*o)*Math.PI*2;for(let d=0;d<t.layers;d++){let v;if(d===0)v=m;else{let M=(d-1)/t.layers;M=1-M,v=p*M}let I=h.stage==="in"?q.in.getProgress(u,d):h.stage==="out"?q.out.getProgress(u,d):1,b,F;d>0&&h.stage==="in"?(b=A.outBack(I,t.layersMag),F=A.outBack(I,t.layersMag)):(b=A[h.stage==="in"?t.easeIn:t.easeOut](I),F=b);let x=O(F,0,1,v,m-v);v*=b;let k=D,E=f;d>0&&(k+=Math.cos(y)*x,E+=Math.sin(y)*x);let R=this.scale(c+(d+1)/t.layers*t.colorsDist).hex();i.fillStyle=R,i.beginPath(),i.arc(k,E,Math.max(v,0),0,Math.PI*2),i.fill()}})});this.width=e,this.height=i,this.root=Z({width:e,height:i},t.minDepth,t.maxDepth),this.root.onCollapse=this.updateLeaves,this.root.onDivide=this.updateLeaves;let r=N("seed");this.noise=X(r),this.leaves=[],this.scale=U.scale(this.palette).mode("rgb")}}const _=new j;let{ctx:ee,resizeCanvas:te}=G(900,900);_.on("resize",te);const ie=new $(900,900);K();const se=a=>{let e=a/3e3,i=Math.floor(e),r=e%1;i%2===1?e=1-r:e=r,t.threshold=O(e,0,1,.8,1),ie.draw(a,ee)};V(se);
