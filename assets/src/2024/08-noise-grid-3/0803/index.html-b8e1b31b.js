var M=Object.defineProperty;var W=(r,t,i)=>t in r?M(r,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[t]=i;var s=(r,t,i)=>(W(r,typeof t!="symbol"?t+"":t,i),i);import"../../../../modulepreload-polyfill-3cfb730f.js";import{c as k}from"../../../../index-8d178fc0.js";import{l as q}from"../../../../loop-9a51de3b.js";import{S as P}from"../../../../sizes-34512445.js";/* empty css                        */import{a as R}from"../../../../alea-811168f2.js";import{c as B}from"../../../../index-168b6c61.js";import{a as G}from"../../../../simplex-noise-c4e77999.js";import{r as w,m as S,d as A}from"../../../../utils-410b772c.js";import{T as Q}from"../../../../timer-edf95207.js";import{R as y}from"../../../../trig-shapes-61ac4bbe.js";import{a as V}from"../../../../lil-gui.esm-da8e181f.js";import{e as T}from"../../../../easings-ac43f515.js";import{g as b,a as O,m as E}from"../../../../helpful-stuff-36d8f740.js";import"../../../../jszip.min-f5692425.js";import"../../../../_commonjsHelpers-725317a4.js";import"../../../../p5.min-89a01bf6.js";import"../../../../_commonjs-dynamic-modules-302442b1.js";const e={minDepth:2,maxDepth:5,delayMin:80,delayMax:800,durationIn:1100,durationOut:800,eachAmount:.7,noiseFreqDiv:2,noiseSpeedDiv:1,noiseFreqColor:1.63,noiseSpeedColor:.2,innerRadiusAmt:.7,layers:3,colorsDist:.2,minAge:0,randomness:.2,divideInt:3e3,easeIn:"outQuint",easeOut:"outQuart"},j=r=>{r.in=b({durationTotal:e.durationIn,durationEach:e.durationIn*e.eachAmount,steps:e.layers}),r.out=b({durationTotal:e.durationOut,durationEach:e.durationOut*e.eachAmount,steps:e.layers})},I={in:b({durationTotal:e.durationIn,durationEach:e.durationIn*e.eachAmount,steps:e.layers}),out:b({durationTotal:e.durationOut,durationEach:e.durationOut*e.eachAmount,steps:e.layers})},N=()=>{const r=new V().close();r.add(e,"minDepth",1,5,1),r.add(e,"maxDepth",1,9,1),r.add(e,"delayMin",0,1500,10),r.add(e,"delayMax",0,1500,10);let t=r.addFolder(".");t.add(e,"layers",1,6,1),t.add(e,"durationIn",0,5e3,10),t.add(e,"durationOut",0,5e3,10),t.add(e,"eachAmount",0,1,.01),t.onChange(()=>{j(I)}),r.add(e,"noiseFreqDiv",0,100,.01),r.add(e,"noiseSpeedDiv",0,100,.01),r.add(e,"noiseFreqColor",0,2,.01),r.add(e,"noiseSpeedColor",0,2,.01),r.add(e,"innerRadiusAmt",0,1,.01),r.add(e,"colorsDist",0,1,.01),r.add(e,"minAge",0,5e3,10),r.add(e,"randomness",0,1,.01),r.add(e,"divideInt",0,1e4,10);let i=Object.keys(T);return r.add(e,"easeIn",i),r.add(e,"easeOut",i),r};let U=0;class D{constructor(t,i,o=0){s(this,"bounds");s(this,"parent");s(this,"children");s(this,"vals");s(this,"timer",null);s(this,"depth");s(this,"birthday");s(this,"stage");s(this,"randomVal");s(this,"cellId");s(this,"lastTime",0);s(this,"delayEnter");s(this,"onDivide");s(this,"onCollapse");s(this,"newBirthday",()=>{this.birthday=this.lastTime});s(this,"update",t=>{this.lastTime=t});s(this,"getAge",t=>this.birthday===-1?-1:t-this.birthday);s(this,"findCell",(t,i)=>{if(this.bounds.contains(t,i)){for(let o of this.children){let n=o.findCell(t,i);if(n)return n}return this}return!1});s(this,"getLeaves",()=>{let t=[];if(this.children.length===0)t.push(this);else for(let i of this.children)t.push(...i.getLeaves());return t});s(this,"flattenCells",()=>{let t=[this];for(let i of this.children)t.push(...i.flattenCells());return t});s(this,"makeTweens",(t=0,i)=>{let o=this.stage==="in"?e.durationIn:e.durationOut;this.timer=new Q({duration:o,easing:"linear"}).delay(t),this.stage==="out"&&this.timer.reverse(1),i&&this.timer.onComplete(i)});s(this,"enter",()=>{this.stage="in",this.makeTweens(this.delayEnter,()=>{this.stage="idle",this.newBirthday()})});s(this,"canDivide",()=>this.stage==="idle"&&this.children.length===0);s(this,"canCollapse",()=>!this.children.some(t=>t.stage!=="idle"||t.children.length>0));s(this,"divide",()=>{let{x:t,y:i,width:o,height:n}=this.bounds,d=o/2,l=n/2;return this.stage="idle",this.children.push(new D(new y(t,i,d,l),this,this.getDelay()),new D(new y(t+d,i,d,l),this,this.getDelay()),new D(new y(t,i+l,d,l),this,this.getDelay()),new D(new y(t+d,i+l,d,l),this,this.getDelay())),this.onDivide&&this.onDivide(this),!0});s(this,"collapse",()=>{this.children=[],this.birthday=-1,this.stage="in",this.makeTweens(0,()=>{this.stage="idle",this.newBirthday(),this.removeTween()}),this.onCollapse&&this.onCollapse(this)});s(this,"setWillDivide",()=>this.canDivide()?(this.stage="out",this.makeTweens(0,()=>{this.stage="idle",this.removeTween(),this.divide()}),!0):!1);s(this,"setWillCollapse",(t=0)=>{if(!this.canCollapse())return!1;if(this.children.length===0)return new Promise(i=>{this.stage="out",this.makeTweens(t,()=>{this.stage="hidden",this.removeTween(),i()})});{let i=[];for(let o=0;o<this.children.length;o++){let d=this.children[o].setWillCollapse(this.getDelay());if(!d)return!1;i.push(d)}return this.stage="childrenOut",this.removeTween(),this.vals.progress=0,Promise.all(i).then(()=>{this.collapse()})}});s(this,"removeTween",()=>{this.timer=null});s(this,"getDelay",()=>w(e.delayMin,e.delayMax));this.bounds=t,this.parent=i,this.stage="in",this.children=[],this.vals={progress:0},this.timer=null,this.depth=i?i.depth+1:0,this.birthday=-1,this.delayEnter=o,this.randomVal=w(-e.randomness/2,e.randomness/2),this.cellId=++U}get progress(){return this.timer?this.timer.progress:this.stage==="idle"?1:0}}const X=(r,t,i,o)=>{let n=new y((r.width-t)/2,(r.height-t)/2,t,t),d=new D(n),l=d.getLeaves(),a=l.filter(p=>p.depth<i).length,f=l.filter(p=>p.depth===o).length,v=w(n.width*.25,n.width*.75)+n.x,u=w(n.width*.25,n.height*.75)+n.y;for(;a>0||f<5;){let p=A(n.x,n.x+n.width,v,.6),c=A(n.y,n.y+n.height,u,.6),m=d.findCell(p,c);m&&m.depth<o&&m.divide();let h=d.getLeaves();f=h.filter(g=>g.depth===o).length,a=h.filter(g=>g.depth<i).length}return d};class Y{constructor(t,i){s(this,"root");s(this,"width");s(this,"height");s(this,"noise");s(this,"leaves");s(this,"palette",["#fed000","#ff8552","#cf3895","#7051b5","#006e96","#06b4b0","#006e96","#7051b5"]);s(this,"scale");s(this,"lastTime",0);s(this,"lastDivTime",0);s(this,"allIdle",!1);s(this,"updateLeaves",()=>{this.leaves=this.root.getLeaves(),this.leaves.forEach(t=>{!t.timer&&t.stage==="in"&&t.enter()})});s(this,"update",t=>{let i=t-this.lastTime;this.lastTime=t;let o=!1;this.allIdle&&(o=!0,this.lastDivTime=t);let n=O(e,["noiseSpeedDiv","noiseFreqDiv"]),{noiseFreqDiv:d,noiseSpeedDiv:l}=E(n,.001);this.leaves.forEach(a=>{var c,m;if(a.timer&&a.timer.tick(i),a.stage!=="idle"||a.getAge(t)<e.minAge||!o)return;let f=a.bounds.x+a.bounds.width/2,v=a.bounds.y+a.bounds.height/2,u=this.noise(f*d,v*d,t*l);u<0?u=T.outQuart(-u)*-1:u=u*u;let p=Math.round(S(u,-1,1,e.minDepth-1,e.maxDepth+1));if(a.idealDepth=p,a.n=u,!(a.depth<p&&a.depth<e.maxDepth&&a.setWillDivide())){if(a.depth>p&&a.depth>e.minDepth){let h=a.parent;if(h&&h.setWillCollapse())return}a.depth===e.maxDepth&&((c=a.parent)!=null&&c.setWillCollapse())||a.depth===e.minDepth&&a.setWillDivide()||a.depth<e.maxDepth&&a.setWillDivide()||a.depth>e.minDepth&&((m=a.parent)!=null&&m.setWillCollapse()||console.log("nothing with this cell",a))}})});s(this,"draw",(t,i)=>{this.update(t),i.fillStyle="#f6eec7",i.fillRect(0,0,this.width,this.height);let o=O(e,["noiseFreqColor","noiseSpeedColor"]),{noiseFreqColor:n,noiseSpeedColor:d}=E(o,.001);this.updateLeaves();let l=!0;this.leaves.forEach(a=>{let f=a.progress;if(f===0)return;let v=a.bounds.width/2,u=v*e.innerRadiusAmt,p=a.bounds.x+a.bounds.width/2,c=a.bounds.y+a.bounds.height/2,m=this.noise(p*n,c*n,t*d);m=S(m,0,1,e.randomness,1-e.randomness-e.colorsDist),m+=a.randomVal;for(let h=0;h<e.layers;h++){let g;if(h===0)g=v;else{let C=(h-1)/e.layers;C=1-C,g=u*C}let F=a.stage==="in"?I.in.getProgress(f,h):a.stage==="out"?I.out.getProgress(f,h):1,x;x=T[a.stage==="in"?e.easeIn:e.easeOut](F),g*=x;let L=this.scale(m+(h+1)/e.layers*e.colorsDist).hex();i.fillStyle=L,i.beginPath(),i.arc(p,c,Math.max(g,0),0,Math.PI*2),i.fill()}a.stage!=="idle"&&(l=!1)}),this.allIdle=l});this.width=t,this.height=i,this.root=X({width:t,height:i},850,e.minDepth,e.maxDepth),this.root.onCollapse=this.updateLeaves,this.root.onDivide=this.updateLeaves;let o=R("seed");this.noise=G(o),this.leaves=[],this.scale=B.scale(this.palette).mode("rgb")}}const z=new P;let{ctx:H,resizeCanvas:J}=k(900,900);z.on("resize",J);const K=new Y(900,900);N();const Z=r=>{K.draw(r,H)};q(Z);
