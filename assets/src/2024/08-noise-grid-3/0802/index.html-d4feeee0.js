var L=Object.defineProperty;var R=(l,e,t)=>e in l?L(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var s=(l,e,t)=>(R(l,typeof e!="symbol"?e+"":e,t),t);import"../../../../modulepreload-polyfill-3cfb730f.js";import{c as F}from"../../../../index-8d178fc0.js";import{S as W}from"../../../../sizes-34512445.js";/* empty css                        */import{a as q}from"../../../../alea-811168f2.js";import{c as z}from"../../../../index-168b6c61.js";import{a as G}from"../../../../simplex-noise-c4e77999.js";import{r as c,d as B,m as Q}from"../../../../utils-410b772c.js";import{T as j}from"../../../../timer-edf95207.js";import{R as v}from"../../../../trig-shapes-61ac4bbe.js";import{a as N}from"../../../../lil-gui.esm-da8e181f.js";import{e as b}from"../../../../easings-ac43f515.js";import{g as C,a as U,m as H}from"../../../../helpful-stuff-36d8f740.js";import{R as J}from"../../../../recorder-e49c81e7.js";import"../../../../_commonjsHelpers-725317a4.js";import"../../../../p5.min-89a01bf6.js";import"../../../../_commonjs-dynamic-modules-302442b1.js";import"../../../../canvas-images-d0bfdd66.js";import"../../../../jszip.min-f5692425.js";const i={minDepth:2,maxDepth:5,delayMin:200,delayMax:1e3,durationIn:1e3,durationOut:1e3,eachAmount:.3,noiseFreqAngle:.5,noiseSpeedAngle:.1,innerRadiusAmt:.7,layers:5,divSpeed:2,biasChangeSpeed:9,minAge:500,layersMag:2,lwMult:.2,easeIn:"outQuad",easeOut:"outQuad",easeThreshold:"outCirc"},K=l=>{l.in=C({durationTotal:i.durationIn,durationEach:i.durationIn*i.eachAmount,steps:i.layers}),l.out=C({durationTotal:i.durationOut,durationEach:i.durationOut*i.eachAmount,steps:i.layers})},M={in:C({durationTotal:i.durationIn,durationEach:i.durationIn*i.eachAmount,steps:i.layers}),out:C({durationTotal:i.durationOut,durationEach:i.durationOut*i.eachAmount,steps:i.layers})},V=()=>{let l=Object.keys(b);const e=new N().close();e.add(i,"minDepth",1,5,1),e.add(i,"maxDepth",1,9,1),e.add(i,"delayMin",0,1500,10),e.add(i,"delayMax",0,1500,10);let t=e.addFolder(".");return t.add(i,"layers",1,6,1),t.add(i,"durationIn",0,5e3,10),t.add(i,"durationOut",0,5e3,10),t.add(i,"eachAmount",0,1,.01),t.onChange(()=>{K(M)}),e.add(i,"noiseFreqAngle",0,2,.01),e.add(i,"noiseSpeedAngle",0,2,.01),e.add(i,"innerRadiusAmt",0,1,.01),e.add(i,"divSpeed",0,6,.1),e.add(i,"biasChangeSpeed",0,10,.1),e.add(i,"minAge",0,5e3,10),e.add(i,"layersMag",0,10,.01),e.add(i,"lwMult",0,2,.01),e.add(i,"easeIn",l),e.add(i,"easeOut",l),e};let X=0;class w{constructor(e,t,r=0){s(this,"bounds");s(this,"parent");s(this,"children");s(this,"vals");s(this,"timer",null);s(this,"depth");s(this,"birthday");s(this,"stage");s(this,"cellId");s(this,"lastTime",0);s(this,"delayEnter");s(this,"onDivide");s(this,"onCollapse");s(this,"newBirthday",()=>{this.birthday=this.lastTime});s(this,"update",e=>{this.lastTime=e});s(this,"getAge",e=>this.birthday===-1?-1:e-this.birthday);s(this,"findCell",(e,t)=>{if(this.bounds.contains(e,t)){for(let r of this.children){let a=r.findCell(e,t);if(a)return a}return this}return!1});s(this,"getLeaves",()=>{let e=[];if(this.children.length===0)e.push(this);else for(let t of this.children)e.push(...t.getLeaves());return e});s(this,"flattenCells",()=>{let e=[this];for(let t of this.children)e.push(...t.flattenCells());return e});s(this,"makeTweens",(e=0,t)=>{let r=this.stage==="in"?i.durationIn:i.durationOut;this.timer=new j({duration:r,easing:"linear"}).delay(e),this.stage==="out"&&this.timer.reverse(1),t&&this.timer.onComplete(t)});s(this,"enter",()=>{this.stage="in",this.makeTweens(this.delayEnter,()=>{this.stage="idle",this.newBirthday()})});s(this,"canDivide",()=>this.stage==="idle"&&this.children.length===0);s(this,"canCollapse",()=>!this.children.some(e=>e.stage!=="idle"||e.children.length>0));s(this,"divide",()=>{let{x:e,y:t,width:r,height:a}=this.bounds,h=r/2,n=a/2;return this.stage="idle",this.children.push(new w(new v(e,t,h,n),this,this.getDelay()),new w(new v(e+h,t,h,n),this,this.getDelay()),new w(new v(e,t+n,h,n),this,this.getDelay()),new w(new v(e+h,t+n,h,n),this,this.getDelay())),this.onDivide&&this.onDivide(this),!0});s(this,"collapse",()=>{this.children=[],this.birthday=-1,this.stage="in",this.makeTweens(0,()=>{this.stage="idle",this.newBirthday(),this.removeTween()}),this.onCollapse&&this.onCollapse(this)});s(this,"setWillDivide",()=>this.canDivide()?(this.stage="out",this.makeTweens(0,()=>{this.stage="idle",this.removeTween(),this.divide()}),!0):!1);s(this,"setWillCollapse",(e=0)=>{if(!this.canCollapse())return!1;if(this.children.length===0)return new Promise(t=>{this.stage="out",this.makeTweens(e,()=>{this.stage="hidden",this.removeTween(),t()})});{let t=[];for(let r=0;r<this.children.length;r++){let h=this.children[r].setWillCollapse(this.getDelay());if(!h)return!1;t.push(h)}return this.stage="childrenOut",this.removeTween(),this.vals.progress=0,Promise.all(t).then(()=>{this.collapse()})}});s(this,"removeTween",()=>{this.timer=null});s(this,"getDelay",()=>c(i.durationIn*.2,i.durationIn*.8));this.bounds=e,this.parent=t,this.stage="in",this.children=[],this.vals={progress:0},this.timer=null,this.depth=t?t.depth+1:0,this.birthday=-1,this.delayEnter=r,this.cellId=++X}get progress(){return this.timer?this.timer.progress:this.stage==="idle"?1:0}}class Y{constructor(e,t){s(this,"root");s(this,"width");s(this,"height");s(this,"noise");s(this,"leaves");s(this,"palette",["#7051b5","#cf3895","#fed000","#ff8552"]);s(this,"scale");s(this,"lastTime",0);s(this,"lastDivTime",0);s(this,"lastBiasChange",0);s(this,"biasPoint");s(this,"initCells",(e,t)=>{let r=850,a=new v((this.width-r)/2,(this.height-r)/2,r,r),h=new w(a),n=h.getLeaves(),g=n.filter(u=>u.depth<e).length,o=n.filter(u=>u.depth===t).length;for(;g>0||o<5;){let u=B(a.x,a.x+a.width,this.biasPoint.x,.6),m=B(a.y,a.y+a.height,this.biasPoint.y,.6),p=h.findCell(u,m);p&&p.depth<t&&p.divide();let y=h.getLeaves();o=y.filter(d=>d.depth===t).length,g=y.filter(d=>d.depth<e).length}return h});s(this,"updateLeaves",()=>{this.leaves=this.root.getLeaves(),this.leaves.forEach(e=>{!e.timer&&e.stage==="in"&&e.enter()})});s(this,"newBias",()=>{this.biasPoint={x:c(this.width*.15,this.width*.85),y:c(this.height*.15,this.height*.85)}});s(this,"update",e=>{let t=e-this.lastTime;this.lastTime=e;let r=!1;this.lastTime-this.lastDivTime>i.divSpeed*1e3&&(r=!0,this.lastDivTime=this.lastTime),this.lastTime-this.lastBiasChange>i.biasChangeSpeed*1e3&&(this.newBias(),this.lastBiasChange=this.lastTime),this.leaves.forEach(a=>{if(a.timer&&a.timer.tick(t),!r||a.stage!=="idle"||a.getAge(e)<i.minAge)return;let h=a.bounds.x+a.bounds.width/2,n=a.bounds.y+a.bounds.height/2,o=Math.sqrt((h-this.biasPoint.x)**2+(n-this.biasPoint.y)**2)/this.width;o=b.outCubic(o);let u=c();if(a.d=o,a.n=u,u>o&&a.depth<i.maxDepth)a.setWillDivide();else if(u<o&&a.depth>i.minDepth){let m=a.parent;m&&m.setWillCollapse()}})});s(this,"draw",(e,t)=>{this.update(e),t.fillStyle="rgb(230,230,230)",t.fillRect(0,0,this.width,this.height);let r=U(i,["noiseFreqAngle","noiseSpeedAngle"]),{noiseSpeedAngle:a,noiseFreqAngle:h}=H(r,.001);this.updateLeaves(),this.leaves.forEach(n=>{let g=n.progress;if(g===0)return;let o=n.bounds.width/2,u=o*i.innerRadiusAmt,m=n.bounds.x+n.bounds.width/2,p=n.bounds.y+n.bounds.height/2,y=this.noise(m*h,p*h,e*a)*Math.PI*2;for(let d=0;d<i.layers;d++){let O=(i.layers-d)*i.lwMult,f;if(d===0)f=o;else{let I=(d-1)/i.layers;I=1-I,f=u*I}let D=n.stage==="in"?M.in.getProgress(g,d):n.stage==="out"?M.out.getProgress(g,d):1,T,A;d>0&&n.stage==="in"?(T=b[i.easeIn](D),A=b[i.easeIn](D)):(T=b[n.stage==="in"?i.easeIn:i.easeOut](D),A=T);let P=Q(A,0,1,f,o-f);f*=T;let x=m,k=p;d>0&&(x+=Math.cos(y)*P,k+=Math.sin(y)*P),t.strokeStyle="#000",t.lineWidth=O,t.beginPath(),t.arc(x,k,Math.max(f-O/2,0),0,Math.PI*2),t.stroke()}})});this.width=e,this.height=t;let r=q("seed");this.noise=G(r),this.leaves=[],this.scale=z.scale(this.palette).mode("rgb"),this.biasPoint={x:c(e*.25,e*.75),y:c(t*.25,t*.75)},this.root=this.initCells(i.minDepth,i.maxDepth),this.root.onCollapse=this.updateLeaves,this.root.onDivide=this.updateLeaves}}const Z=new W;let{ctx:S,resizeCanvas:$}=F(900,900);Z.on("resize",$);const E=new Y(900,900),_=V(),ee=()=>{let l=0;return new J({canvas:S.canvas,gui:_,fns:{drawRecord:t=>(l=t*15,E.draw(l,S),!1),draw:t=>{E.draw(t,S)}},useTime:!0})},te=ee();te.toggleLoop();
