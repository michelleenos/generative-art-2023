var H=Object.defineProperty;var U=(r,i,e)=>i in r?H(r,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[i]=e;var n=(r,i,e)=>(U(r,typeof i!="symbol"?i+"":i,e),e),V=(r,i,e)=>{if(!i.has(r))throw TypeError("Cannot "+e)};var g=(r,i,e)=>(V(r,i,"read from private field"),e?e.call(r):i.get(r)),P=(r,i,e)=>{if(i.has(r))throw TypeError("Cannot add the same private member more than once");i instanceof WeakSet?i.add(r):i.set(r,e)},v=(r,i,e,t)=>(V(r,i,"write to private field"),t?t.call(r,e):i.set(r,e),e);import{T as Q}from"./timer-edf95207.js";import{r as m,s as X}from"./utils-410b772c.js";import{d as N,h as B,l as $}from"./shapes-52b2702a.js";import{e as j}from"./easings-ac43f515.js";import{c as G}from"./simplex-noise-c4e77999.js";class q{constructor({nx:i,ny:e,w:t,h:s,color:a,duration:l=1e3,easing:o="outCubic"}){n(this,"nx");n(this,"ny");n(this,"w");n(this,"h");n(this,"prevUnitSize",0);n(this,"prevSizes",{x:0,y:0,w:0,h:0,m:0});n(this,"color");n(this,"stage","none");n(this,"timer");n(this,"hasShown",!1);n(this,"switchedLastFrame",!1);n(this,"drawStatic",(i,e)=>{this.draw(i,e,1)});this.nx=i,this.ny=e,this.w=t,this.h=s,this.color=a,this.timer=new Q({duration:l,easing:o})}get animating(){return this.stage==="enter"||this.stage==="leave"}get duration(){return this.timer.duration}set duration(i){this.timer.duration=i}reset(){this.stage="none",this.hasShown=!1,this.timer.reset()}tick(i){if(this.timer.tick(i),this.switchedLastFrame=!1,!(this.stage!=="enter"&&this.stage!=="leave")){if(this.timer.progress>=1&&this.stage==="enter"){this.stage="show",this.hasShown=!0,this.switchedLastFrame=!0;return}if(this.stage==="leave"&&this.timer.progress<=0){this.stage="none",this.switchedLastFrame=!0;return}}}getSizes(i){return i===this.prevUnitSize?this.prevSizes:(this.prevUnitSize=i,this.prevSizes={x:this.nx*i,y:this.ny*i,w:this.w*i,h:this.h*i,m:Math.min(this.w,this.h)*i})}start(){this.stage="enter",this.timer.restart()}reverse(){this.stage="leave",this.timer.reverse()}complete(){this.timer.complete(),this.stage="show"}}class J extends q{constructor({corner:e,...t}){super(t);n(this,"style","triangle");n(this,"corner");n(this,"draw",(e,t,s=this.timer.progress)=>{let{x:a,y:l,w:o,h}=this.getSizes(t);e.fillStyle=this.color,N(e,{x:a,y:l,w:o,h,corner:this.corner,progress:s}),e.fill()});this.corner=e||m(["tl","tr","bl","br"])}}class K extends q{constructor({direction:e,...t}){super(t);n(this,"style","halfCircle");n(this,"dir");n(this,"draw",(e,t,s=this.timer.progress)=>{let{x:a,y:l,w:o,h}=this.getSizes(t);e.fillStyle=this.color,B(e,{x:a,y:l,w:o,h,dir:this.dir,progress:s}),e.fill()});this.dir=e||(t.w>t.h?m(["up","down"]):m(["left","right"]))}}class Z extends q{constructor({corner:e,pattern:t,...s}){super(s);n(this,"style","quarterCircle");n(this,"corner");n(this,"pattern");n(this,"lineWidthRatio",.05);this.corner=e||m(["tl","tr","bl","br"]),this.pattern=t||m(["fill","lines"])}drawCurve(e,t,s=0,a=this.timer.progress){let{x:l,y:o,w:h,h:u,m:c}=this.getSizes(t),f=Math.max(c*a-s,0);if(this.pattern==="lines"){e.strokeStyle=this.color;let F=c*this.lineWidthRatio;e.lineWidth=F,s+=F/2}else e.fillStyle=this.color;e.beginPath();let d=l,S=l+h,_=o,w=o+u;this.corner.endsWith("l")&&(d=Math.min(l+h-a*h+s,l+h)),this.corner.endsWith("r")&&(S=Math.max(l+a*h-s,l)),this.corner.startsWith("t")&&(_=Math.min(o+u-a*u+s,o+u)),this.corner.startsWith("b")&&(w=Math.max(o+a*u-s,o));let p=[[d,w],[d,_],[S,_],[S,w]],C=this.corner==="tl"?0:this.corner==="tr"?1:this.corner==="br"?2:3,y=p[C],D=p[(C+1)%4],W=p[(C+2)%4],I=p[(C+3)%4];e.moveTo(y[0],y[1]),e.arcTo(D[0],D[1],W[0],W[1],f),e.lineTo(W[0],W[1]),this.pattern==="fill"?(e.lineTo(I[0],I[1]),e.closePath(),e.fill()):e.stroke()}draw(e,t,s=this.timer.progress){let{m:a,x:l,y:o,w:h,h:u}=this.getSizes(t);if(e.save(),e.beginPath(),e.rect(l,o,h,u),e.clip(),this.pattern==="fill")this.drawCurve(e,t,0,s);else{let c=5,f=a/(c+1);for(let d=0;d<c;d++)this.drawCurve(e,t,f*d,s)}e.restore()}}class x extends q{constructor({corner:e,...t}){super(t);n(this,"style","leaf");n(this,"corner");this.corner=e||m(["tl","tr","bl","br"])}draw(e,t,s=this.timer.progress){let{x:a,y:l,w:o,h}=this.getSizes(t);e.fillStyle=this.color,$(e,{x:a,y:l,w:o,h,corner:this.corner,progress:s}),e.fill()}}class ee extends q{constructor(){super(...arguments);n(this,"style","circle")}draw(e,t,s=this.timer.progress){let{x:a,y:l,w:o,h}=this.getSizes(t);e.fillStyle=this.color,e.beginPath(),e.arc(a+o/2,l+h/2,o/2*s,0,Math.PI*2),e.fill()}}var L,O,R,T,k;class te extends q{constructor(e){super(e);n(this,"style","lines");n(this,"dir");P(this,L,void 0);P(this,O,void 0);P(this,R,void 0);P(this,T,void 0);P(this,k,void 0);n(this,"padding");n(this,"lineWidth",.05);n(this,"setLineVals",()=>{v(this,R,g(this,O)/this.timer.duration),v(this,T,(this.timer.duration-g(this,O))/(g(this,L)-1)),v(this,k,g(this,T)/this.timer.duration)});this.dir=m(e.dirOptions?e.dirOptions:["h","v","d1","d2"]),v(this,L,this.dir.startsWith("d")?e.diagSteps||e.steps||10:e.steps||5),this.lineEach=e.each?e.each:this.timer.duration*.4,e.lineWidth&&(this.lineWidth=e.lineWidth),this.padding=this.lineWidth/2}get lineEach(){return g(this,O)}set lineEach(e){v(this,O,e>this.timer.duration?this.timer.duration:e),this.setLineVals()}get steps(){return g(this,L)}set steps(e){v(this,L,e),this.setLineVals()}draw(e,t,s=this.timer.progress){if(s===0)return;let{x:a,y:l,w:o,h}=this.getSizes(t);e.save(),e.beginPath(),e.rect(a,l,o,h),e.clip(),e.lineCap="square";let u=o*this.lineWidth,c=this.padding*o;e.lineWidth=u,e.strokeStyle=this.color,e.beginPath();let f=o/g(this,L)*2;(this.dir==="h"||this.dir==="v")&&(f=(o-c*2)/(g(this,L)-1));for(let d=0;d<g(this,L);d++){let S=g(this,k)*d;if(s<S)continue;let _=Math.min(1,(s-S)/g(this,R)),w,p,C,y;this.dir==="d1"?[w,p,C,y]=[a,l+f*(d+.5),f*(d+.5),-f*(d+.5)]:this.dir==="d2"?[w,p,C,y]=[a,l+h-f*(d+.5),f*(d+.5),f*(d+.5)]:this.dir==="h"?[w,p,C,y]=[a,l+f*d+c,o,0]:[w,p,C,y]=[a+f*d+c,l,0,h],e.moveTo(w,p),e.lineTo(w+C*_,p+y*_)}e.stroke(),e.restore()}}L=new WeakMap,O=new WeakMap,R=new WeakMap,T=new WeakMap,k=new WeakMap;class Y extends q{constructor({corner:e,duration:t=4e3,innerRatio:s=.1,outerRatio:a=.9,...l}){super({...l,duration:t});n(this,"corner");n(this,"arcStart");n(this,"arcChange");n(this,"counterclockwise");n(this,"_innerRatio");n(this,"_outerRatio");this.corner=e||m(["tl","tr","bl","br"]),this._innerRatio=s,this._outerRatio=a,this.arcStart=this.w>this.h?Math.PI*-.5:Math.PI,this.arcChange=Math.PI*.5*(this.w>this.h?-1:1),this.counterclockwise=this.w>this.h}translate(e,t){let{x:s,y:a,w:l,h:o}=t;e.translate(s,a),this.corner==="tr"?(e.scale(-1,1),e.translate(-l,0)):this.corner==="bl"?(e.scale(1,-1),e.translate(0,-o)):this.corner==="br"&&(e.scale(-1,-1),e.translate(-l,-o))}}class ie extends Y{constructor({corner:e,...t}){super({...t,corner:e});n(this,"style","quarterCircleFill")}draw(e,t,s=this.timer.progress){let a=this.getSizes(t),{w:l,h:o,m:h}=a,u=h*this._innerRatio,c=h*this._outerRatio;if(e.save(),this.translate(e,a),e.fillStyle=this.color,e.beginPath(),o===l)e.arc(h,h,c,this.arcStart,this.arcStart+this.arcChange*s),e.arc(h,h,u,this.arcStart+this.arcChange*s,this.arcStart,!0);else{let f=s>=.5?1:s*2,d=s<.5?0:(s-.5)*2;l>o?(e.moveTo(l-h*f,o-u),e.lineTo(l,o-u),e.lineTo(l,o-c),e.lineTo(l-h*f,o-c),d>0&&(e.arc(h,h,c,this.arcStart,this.arcStart+this.arcChange*d,this.counterclockwise),e.arc(h,h,u,this.arcStart+this.arcChange*d,this.arcStart,!this.counterclockwise))):(e.moveTo(l-u,o-h*f),e.lineTo(l-u,o),e.lineTo(l-c,o),e.lineTo(l-c,o-h*f),d>0&&(e.arc(h,h,c,this.arcStart,this.arcStart+this.arcChange*d,this.counterclockwise),e.arc(h,h,u,this.arcStart+this.arcChange*d,this.arcStart,!this.counterclockwise)))}e.fill(),e.restore()}}var E,b,M,z,A;class se extends Y{constructor({corner:e,...t}){super({...t,corner:e});n(this,"style","quarterCircleLines");n(this,"lineWidth",.05);P(this,E,5);P(this,b,void 0);P(this,M,void 0);P(this,z,void 0);P(this,A,void 0);n(this,"setLineVals",()=>{v(this,z,g(this,b)/this.timer.duration),v(this,M,(this.timer.duration-g(this,b))/(g(this,E)-1)),v(this,A,g(this,M)/this.timer.duration)});t.steps&&v(this,E,t.steps),this.lineWidth=t.lineWidth??this.lineWidth,this.lineEach=t.each??this.timer.duration*.4,this.setLineVals()}get lineEach(){return g(this,b)}set lineEach(e){v(this,b,e>this.timer.duration?this.timer.duration:e),this.setLineVals()}set duration(e){this.timer.duration=e,g(this,b)>e&&(this.lineEach=e),this.setLineVals()}get duration(){return this.timer.duration}get steps(){return g(this,E)}set steps(e){v(this,E,e),this.setLineVals()}draw(e,t,s=this.timer.progress){let a=this.getSizes(t),{w:l,h:o,m:h}=a,u=h*this.lineWidth;e.strokeStyle=this.color,e.lineWidth=u;let c=h*this._innerRatio+u/2,d=(h*this._outerRatio-u/2-c)/(g(this,E)-1);e.save(),this.translate(e,a);for(let S=0;S<g(this,E);S++){let _=g(this,A)*S;if(s<_)break;let w=c+d*S,p=j[this.timer.easing](Math.min(1,(s-_)/g(this,z))),[C,y]=l>o?[l,h-w]:[h-w,o];if(e.beginPath(),o===l)e.arc(h,h,w,this.arcStart,this.arcStart+p*this.arcChange);else{let D=p>=.5?1:p*2,W=p<.5?0:(p-.5)*2;e.moveTo(C,y),l>o?e.lineTo(C-h*D,y):e.lineTo(C,y-h*D),W>0&&e.arc(h,h,w,this.arcStart,this.arcStart+this.arcChange*W,this.counterclockwise)}e.stroke()}e.restore()}}E=new WeakMap,b=new WeakMap,M=new WeakMap,z=new WeakMap,A=new WeakMap;let re=G();const le=(r,i)=>r<0||r>=i*i?{x:-1,y:-1}:{x:r%i,y:Math.floor(r/i)},ae=(r,i,e)=>r<0||r>=e||i<0||i>=e?-1:i*e+r,ne=(r,i,e,t,s)=>s==="wave"?r%2===0?i%2===0?"tl":"br":i%2===0?"tr":"bl":s==="circle"?e>t?i%2===0?m(["tl","tr"]):m(["bl","br"]):t>t?r%2===0?m(["tl","bl"]):m(["tr","br"]):r%2===0?i%2===0?"tl":"bl":i%2===0?"tr":"br":m(["tl","tr","bl","br"]),he=(r,i,e,t,s)=>{let a;return s==="wave"?a=r%2===0?i%2===0?"up":"down":i%2===0?"left":"right":s==="circle"&&(e>t&&(a=i%2===0?"up":"down"),t>e&&(a=r%2===0?"left":"right")),a||(e>t?m(["up","down"]):m(["left","right"]))},oe=r=>["quarterCircle","triangle","quarterCircleFill","quarterCircleLines","leaf"].includes(r),ce=r=>["halfCircle"].includes(r),de=(r,i)=>{switch(i){case"triangle":return new J(r);case"halfCircle":return new K(r);case"quarterCircle":return new Z(r);case"leaf":return new x(r);case"circle":return new ee(r);case"lines":return new te(r);case"quarterCircleFill":return new ie(r);case"quarterCircleLines":return new se(r)}},ue=(r,i)=>{const e=Array.from({length:r*r},()=>null);let t=0;const s=[];for(;t<e.length;){if(e[t]){t++;continue}let a=le(t,r);if(a.x<0||a.y<0)break;let{x:l,y:o}=a,h=l<r-1&&e[t+1]===null,u=o<r-1&&e[t+r]===null,c=me(l,o,{...i,canRectX:h,canRectY:u});s.push(c),e[t]=c,c.w>c.h&&(e[t+1]=c),c.h>c.w&&(e[t+r]=c)}return{cells:s,map:e}},fe=["triangle","lines","quarterCircle","circle","leaf"],ge=["halfCircle","quarterCircle"],me=(r,i,e)=>{let{cornersPattern:t=!1,canRectX:s=!1,canRectY:a=!1,rectChance:l=.5,squareOptions:o=fe,rectOptions:h=ge}=e,u;t==="circle"&&(r%2!==0||i%2!==0)&&(s=!1,a=!1),e.shape?u=e.shape:(s||a)&&Math.random()<l?u=s&&a?m(["horiz","vert"]):s?"horiz":"vert":u="square";let c;e.noisePattern?c=pe(r,i,u==="square"?o:h):c=u==="square"?m(o):m(h);let[f,d]=[u==="horiz"?2:1,u==="vert"?2:1],S={nx:r,ny:i,w:f,h:d,easing:e.easing,duration:e.duration,corner:oe(c)?ne(r,i,f,d,t):void 0,direction:ce(c)?he(r,i,f,d,t):void 0,color:e.colors?m(e.colors):"#fff"};return(c==="quarterCircleFill"||c==="quarterCircleLines"||c==="lines")&&e.styleOpts&&e.styleOpts[c]&&(S={...S,...e.styleOpts[c]}),de(S,c)},pe=(r,i,e)=>{let t=e.length,s=100,a=Math.abs(re((r+900)/s,(i-1200)/s))*t*2;return a=Math.floor(a),e[a%t]},we=(r,i,e)=>{let t=Array.from({length:e*e},()=>-1);return i==="linear-x"?r.sort((s,a)=>{const l=s.ny-a.ny;return l!==0?l:Math.random()>.5?s.nx-a.nx:a.nx-s.nx}):i==="linear-y"?r.sort((s,a)=>{const l=s.nx-a.nx;return l!==0?l:Math.random()>.5?s.ny-a.ny:a.ny-s.ny}):i==="random"?r=X(r):i==="circle"?r.sort((s,a)=>{const l=Math.floor(s.ny/2)-Math.floor(a.ny/2);return l!==0?l:Math.floor(s.nx/2)-Math.floor(a.nx/2)}):i==="diag-tl"?r.sort((s,a)=>s.ny+s.nx-(a.ny+a.nx)):i==="diag-tr"&&r.sort((s,a)=>s.ny+(e-s.nx)-(a.ny+(e-a.nx))),r.forEach((s,a)=>{let l=ae(s.nx,s.ny,e);l>=0&&(t[l]=a,s.w>1&&(t[l+1]=a),s.h>1&&(t[l+e]=a))}),{cells:r,map:t}};class Se{constructor(i){n(this,"size");n(this,"sides",10);n(this,"cells",[]);n(this,"noisePattern",!1);n(this,"palette",["#1a1a1a"]);n(this,"map",[]);n(this,"mapRef",[]);n(this,"styleOpts",{});n(this,"squareOptions",["triangle","triangle","lines","quarterCircle","circle","leaf"]);n(this,"rectOptions",["halfCircle","quarterCircle"]);n(this,"rectChance",.5);n(this,"cornerPattern",!1);this.size=i.size,this.sides=i.sides||this.sides,this.squareOptions=i.squareOptions||this.squareOptions,this.rectOptions=i.rectOptions||this.rectOptions,this.rectChance=i.rectChance!==void 0?i.rectChance:this.rectChance,this.cornerPattern=i.cornerPattern||this.cornerPattern,this.noisePattern=i.noisePattern||this.noisePattern,i.palette&&(this.palette=i.palette)}get count(){return this.cells.length}setColors(i){this.palette=i,this.setCellColors()}setCellColors(){this.cells.forEach(i=>i.color=m(this.palette))}create(i={}){let{map:e,cells:t}=ue(this.sides,{rectChance:this.rectChance,cornersPattern:this.cornerPattern,squareOptions:this.squareOptions,rectOptions:this.rectOptions,colors:this.palette,styleOpts:this.styleOpts,noisePattern:this.noisePattern,...i});this.mapRef=e,this.cells=t}draw(i){let e=this.size/this.sides;this.cells.forEach(t=>t.draw(i,e))}}class Ee extends Se{constructor(e){super(e);n(this,"_animation","loop");n(this,"_addPerSecond",10);n(this,"_cellDuration",800);n(this,"_cellDurationLines",800);n(this,"_cellEase","outQuad");n(this,"_addDuration",0);n(this,"order","random");n(this,"inOutWait",1e3);n(this,"_steps",{lastAdd:-1,lastLeave:-1,shouldEnter:!1,shouldLeave:!1,shouldWait:!1});n(this,"delta",0);n(this,"timer");n(this,"debug",!1);n(this,"setShouldStep",()=>{let e=this._steps;this._animation==="enter"?(e.shouldEnter=!0,e.shouldLeave=!1):this._animation==="leave"?(e.shouldLeave=!0,e.shouldEnter=!1):this._animation==="loop"&&(e.shouldEnter=!0,e.shouldLeave=!1)});e.addPerSecond&&(this.addPerSecond=e.addPerSecond),e.cellDuration&&(this.cellDuration=e.cellDuration),e.cellEase&&(this.cellEase=e.cellEase),e.inOutWait&&(this.inOutWait=e.inOutWait),e.animation&&(this._animation=e.animation),e.order&&(this.order=e.order),this.timer=new Q({easing:e.addEase}),this.setShouldStep()}get addDuration(){return this._addDuration}get animation(){return this._animation}get addPerSecond(){return this._addPerSecond}set addPerSecond(e){this._addPerSecond=e,this._addDuration=this.cells.length/this._addPerSecond*1e3}set cellDuration(e){this._cellDuration=e,this.cells.forEach(t=>{t.style.toLowerCase().includes("lines")||(t.duration=e)})}get cellDuration(){return this._cellDuration}get cellDurationLines(){return this._cellDurationLines}set cellDurationLines(e){this._cellDurationLines=e,this.cells.forEach(t=>{t.style.toLowerCase().includes("lines")&&(t.duration=e)})}set cellEase(e){this._cellEase=e,this.cells.forEach(t=>t.timer.easing=e)}get cellEase(){return this._cellEase}get addEase(){return this.timer.easing}set addEase(e){this.timer.easing=e}create(){super.create({easing:this.cellEase,duration:this.cellDuration}),this._addDuration=this.cells.length/this._addPerSecond*1e3,this.timer.duration=this._addDuration;let{map:e,cells:t}=we(this.cells,this.order,this.sides);this.map=e,this.cells=t}enter(){this._animation="enter",this.reset()}leave(){this._animation="leave",this.reset(!1)}reset(e=!0){e?(this.cells.forEach(t=>t.reset()),this._steps.lastAdd=-1,this.timer.reset(),this.timer.duration=this.addDuration):(this.cells.forEach(t=>t.complete()),this.timer.reverse(1),this.timer.duration=this.addDuration),this._steps.lastLeave=-1,this.delta=0,this.setShouldStep()}leaveStep(){let e=Math.round(this.timer.progress*(this.cells.length-1)),t=this._steps;if(e>t.lastLeave&&e<this.cells.length){let s=t.lastLeave+1;for(;s<=e;){let a=this.cells[s];if(a.stage!=="show")break;a.reverse(),s++}this.setLastLeaveIndex(s-1)}}enterStep(){let e=Math.round(this.timer.progress*(this.cells.length-1)),t=this._steps;if(e>t.lastAdd&&e<this.cells.length){let s=t.lastAdd+1;for(;s<=e;){let a=this.cells[s];if(a.stage!=="none")break;a.start(),s++}this.setLastAddIndex(s-1)}}waitStep(){this.timer.progress>=1&&(this._steps.lastAdd>=this.cells.length-1?(this._steps.shouldLeave=!0,this._steps.lastAdd=-1):(this._steps.shouldEnter=!0,this._steps.lastLeave=-1,this.create()),this.timer.duration=this.addDuration,this.timer.reset(),this._steps.shouldWait=!1)}tick(e){if(this.delta=e,this.timer.tick(this.delta),!this._animation)return;let t=this._steps;t.shouldWait&&this.waitStep(),t.shouldEnter&&this.enterStep(),t.shouldLeave&&this.leaveStep()}setLastAddIndex(e){let t=this._steps;t.lastAdd=e,t.lastAdd>=this.cells.length-1&&(this._animation==="loop"?(this.timer.reset(),this.timer.duration=this.inOutWait,t.shouldEnter=!1,t.shouldLeave=!1,t.shouldWait=!0):t.shouldEnter=!1)}setLastLeaveIndex(e){let t=this._steps;t.lastLeave=e,t.lastLeave>=this.cells.length-1&&(this._animation==="loop"?(this.timer.duration=this.inOutWait,this.timer.reset(),t.shouldEnter=!1,t.shouldLeave=!1,t.shouldWait=!0):t.shouldLeave=!1)}draw(e,t){if(t===void 0)return super.draw(e);this.tick(t);let s=this.size/this.sides;for(let a=0;a<this.cells.length;a++){let l=this.cells[a];l.stage==="show"?l.drawStatic(e,s):(l.stage==="enter"||l.stage==="leave")&&(l.tick(this.delta),l.draw(e,s)),this.debug&&(e.font="10px Arial",e.textAlign="center",e.fillStyle="black",e.fillText(l.stage,l.nx*s+l.w*.5*s,l.ny*s+l.h*.5*s),e.fillText(`${l.timer.progress}`,l.nx*s+l.w*.5*s,l.ny*s+l.h*.5*s+10))}}}export{Ee as A};
